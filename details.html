<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <title>Asset Specifications | MASTER SYSTEM V167</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600;700;800&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    :root { --navy: #0B1829; --navy-dark: #060F1A; --gold: #C9A84C; --white: #FFFFFF; --border: rgba(201, 168, 76, 0.15); --card-bg: #0F172A; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background-color: var(--navy-dark); color: #FDFAF5; font-family: 'Montserrat', sans-serif; -webkit-font-smoothing: antialiased; }

    #gatekeeper { position: fixed; inset: 0; background: var(--navy-dark); z-index: 10001; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 40px; }
    #pageSplash { position: fixed; inset: 0; background: var(--navy-dark); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10000; transition: opacity 0.4s; }
    .splash-brand { color: var(--gold); font-size: 1.2rem; font-weight: 800; letter-spacing: 4px; text-transform: uppercase; }

    header { position: fixed; top: 0; width: 100%; height: 55px; background: rgba(11, 24, 41, 0.95); backdrop-filter: blur(10px); z-index: 1000; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 15px; }
    .back { text-decoration: none; color: var(--gold); font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; }

    .gallery-container { margin-top: 65px; padding: 0 15px; max-width: 1100px; margin: 0 auto; }
    .gallery-card { background: #000; border-radius: 18px; border: 1px solid var(--border); overflow: hidden; box-shadow: 0 15px 35px rgba(0,0,0,0.3); margin-bottom: 20px; }
    .main-stage { position: relative; width: 100%; aspect-ratio: 16 / 10; background: #000; overflow: hidden; }
    .main-img { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.3s; }
    .nav-arrow { position: absolute; top: 50%; transform: translateY(-50%); width: 44px; height: 44px; border-radius: 50%; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 10; }

    .thumb-row { display: flex; gap: 10px; padding: 12px; overflow-x: auto; background: rgba(0,0,0,0.03); scrollbar-width: none; }
    .thumb { width: 90px; aspect-ratio: 16 / 10; border-radius: 8px; object-fit: cover; opacity: 0.5; cursor: pointer; border: 2px solid transparent; flex-shrink: 0; transition: 0.2s; }
    .thumb.active { opacity: 1; border-color: var(--gold); }
    .tag-count { position: absolute; right: 15px; bottom: 15px; background: rgba(0,0,0,0.6); color: white; padding: 4px 10px; border-radius: 50px; font-size: 10px; font-weight: 600; }

    .content { padding: 10px 15px 120px; max-width: 900px; margin: 0 auto; }
    .info-card { background: var(--card-bg); border-radius: 12px; padding: 22px; margin-bottom: 15px; border: 1px solid var(--border); }
    .section-title { font-size: 0.65rem; font-weight: 700; color: var(--gold); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 18px; display: flex; align-items: center; gap: 8px; }
    .section-title::after { content: ''; flex: 1; height: 1px; background: var(--border); }

    .label { font-size: 0.55rem; color: #7A9BB5; text-transform: uppercase; font-weight: 500; letter-spacing: 1.2px; margin-bottom: 3px; }
    .val { font-size: 0.85rem; font-weight: 400; color: #FFF; }
    .gold-txt { color: var(--gold); font-weight: 600; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

    .nearby-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 0.5px solid var(--border); }
    .loc-name { font-size: 0.78rem; font-weight: 300; }
    .loc-dist { font-size: 0.75rem; font-weight: 400; color: var(--gold); }

    /* à¹à¸œà¸™à¸—à¸µà¹ˆ: à¸ªà¸µà¹ˆà¹€à¸«à¸¥à¸µà¹ˆà¸¢à¸¡à¸ˆà¸±à¸•à¸¸à¸£à¸±à¸ª, à¸ˆà¸³à¸à¸±à¸” 500px à¸šà¸™ desktop */
    .map-box { width: 100%; aspect-ratio: 1 / 1; max-height: 500px; border-radius: 12px; overflow: hidden; border: 1px solid var(--border); margin: 10px 0; }
    #leafletMap { width: 100%; height: 100%; background: #0F172A; }
    .leaflet-control-attribution { display: none !important; }

    .map-legend { display: flex; gap: 20px; margin-bottom: 8px; }
    .map-legend-item { display: flex; align-items: center; gap: 7px; font-size: 0.62rem; color: #9AB; font-weight: 600; letter-spacing: 1.2px; text-transform: uppercase; }
    .legend-line { width: 32px; height: 4px; border-radius: 2px; }
    .legend-red   { background: repeating-linear-gradient(to right, #FF2222 0px, #FF2222 8px, transparent 8px, transparent 13px); }
    .legend-green { background: repeating-linear-gradient(to right, #00EE44 0px, #00EE44 11px, transparent 11px, transparent 17px); }

    /* âŒ à¹„à¸¡à¹ˆà¸¡à¸µà¸›à¸¸à¹ˆà¸¡ GPS Navigation */

    .footer { position: fixed; bottom: 0; width: 100%; background: #060F1A; padding: 12px 15px; border-top: 1px solid var(--border); z-index: 1000; }
    .btn-chat { background: var(--gold); color: #060F1A; text-decoration: none; padding: 15px; border-radius: 4px; display: block; text-align: center; font-size: 0.88rem; letter-spacing: 2px; text-transform: uppercase; font-weight: 800; }
    @media (min-width: 768px) { .nearby-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0 30px; } }
  </style>
</head>
<body>
  <div id="gatekeeper">
    <i class="fas fa-lock" style="font-size: 50px; color: var(--gold); margin-bottom: 20px;"></i>
    <h2 style="color: var(--gold); font-weight: 800; margin-bottom: 10px;">ASSET UNAVAILABLE</h2>
    <p style="color: #7A9BB5; font-size: 0.8rem; margin-bottom: 30px;">This property has been taken offline or is under review.</p>
    <a href="index.html" style="background: var(--gold); color: #060F1A; padding: 12px 30px; border-radius: 50px; font-weight: 800; text-decoration: none; text-transform: uppercase; font-size: 11px;">Back to Catalog</a>
  </div>

  <div id="pageSplash"><div class="splash-brand">MASTER CATALOG</div></div>
  <header><a href="index.html" class="back">âœ• Close</a><div style="font-weight:800; color:var(--gold);">MASTER CATALOG</div><div style="width:40px;"></div></header>

  <div id="mainUI">
    <div class="gallery-container"><div class="gallery-card"><div class="main-stage">
      <img id="mainImg" class="main-img" src="">
      <div class="nav-arrow" style="left:10px" onclick="changeSlide(-1)">â®</div>
      <div class="nav-arrow" style="right:10px" onclick="changeSlide(1)">â¯</div>
      <div class="tag-count" id="countLabel">0 / 0</div>
    </div><div class="thumb-row" id="thumbStrip"></div></div></div>

    <main class="content">
      <div class="info-card">
        <div style="font-size: 0.6rem; color: var(--gold); font-weight: 800; margin-bottom: 5px;" id="pID">HP-XXXX</div>
        <h1 id="pPlot" style="font-family:'Playfair Display',serif; font-size: 1.8rem; color: var(--gold); margin-bottom: 5px; font-weight: 800;">Plot ...</h1>
        <div id="pLocText" style="font-size: 0.75rem; color: #7A9BB5; margin-bottom: 20px;">ğŸ“ -</div>
        <div id="pPrice" style="font-size: 1.4rem; font-weight: 700; color: #FFF; margin-bottom: 20px;">à¸¿0</div>
        <div class="grid">
          <div><div class="label">Bed / Bath</div><div class="val" id="vBB">-</div></div>
          <div><div class="label">Living Area</div><div class="val" id="vLiving">-</div></div>
          <div><div class="label">Land Size</div><div class="val" id="vLand">-</div></div>
          <div><div class="label">Price per Sq.m</div><div class="val gold-txt" id="vPriceSq">-</div></div>
        </div>
      </div>

      <div class="info-card">
        <h2 class="section-title">Specifications</h2>
        <div class="grid">
          <div><div class="label">Status</div><div class="val" id="vStatus">-</div></div>
          <div><div class="label">Furnishing</div><div class="val" id="vFurnish">-</div></div>
          <div><div class="label">District</div><div class="val" id="vDistrict">-</div></div>
          <div><div class="label">Sub-district</div><div class="val" id="vSubDistrict">-</div></div>
          <div><div class="label">Zone</div><div class="val gold-txt" id="vZone">-</div></div>
          <div><div class="label">Pool System</div><div class="val" id="vPoolSys">-</div></div>
          <div><div class="label">Pool Info</div><div class="val" id="vPool">-</div></div>
          <div><div class="label">Kitchen Type</div><div class="val" id="vKitchen">-</div></div>
          <div><div class="label">Parking</div><div class="val" id="vParking">-</div></div>
          <div><div class="label">Direction</div><div class="val" id="vDirect">-</div></div>
          <div><div class="label">Utility Info</div><div class="val" id="vUtil">-</div></div>
        </div>
      </div>

      <div class="info-card" style="border-left: 4px solid var(--gold);">
        <h2 class="section-title">Ownership & Fees</h2>
        <div class="grid">
          <div><div class="label">Monthly Fee</div><div class="val" id="vFeeM">-</div></div>
          <div><div class="label">Yearly Total</div><div class="val gold-txt" id="vFeeY">-</div></div>
          <div><div class="label">Ownership</div><div class="val" id="vOwner">-</div></div>
          <div><div class="label">Transfer Exp.</div><div class="val" id="vTransfer">-</div></div>
        </div>
      </div>

      <div class="info-card">
        <h2 class="section-title">Description</h2>
        <p id="vDesc" style="font-size: 0.82rem; line-height: 1.8; color: #CCC; font-weight: 300; white-space: pre-line;">-</p>
      </div>

      <div class="info-card">
        <h2 class="section-title">Location & Navigation</h2>
        <div class="map-legend" id="mapLegend" style="display:none;">
          <div class="map-legend-item"><div class="legend-line legend-red"></div> Sub-district</div>
          <div class="map-legend-item"><div class="legend-line legend-green"></div> District</div>
        </div>
        <!-- âŒ à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸´à¸à¸±à¸” à¹„à¸¡à¹ˆà¸¡à¸µà¸›à¸¸à¹ˆà¸¡ GPS -->
        <div class="map-box" id="mapBox" style="display:none;">
          <div id="leafletMap"></div>
        </div>
      </div>

      <div class="info-card">
        <h2 class="section-title">Nearby Lifestyle & Amenities</h2>
        <div id="nearbyGrid" class="nearby-grid"></div>
      </div>
    </main>
  </div>

  <div class="footer"><a href="https://line.me/R/ti/p/@qap7218t" class="btn-chat">ğŸ’¬ Live Chat Concierge</a></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyOnZc6s05eGvHR5XmRnRPAat8vNZpf8cFhL2GiAFjWld-2OBf2OqgP07RU07UTZgDXxA/exec';
    const hpId = new URLSearchParams(window.location.search).get('id');
    let images = [], idx = 0;

    const LANDMARKS = [
      { name:"Hua Hin Beach",       lat:12.5696, lon:99.9602 },
      { name:"Cicada Market",       lat:12.5342, lon:99.9655 },
      { name:"Bluport Hua Hin Mall",lat:12.5518, lon:99.9631 },
      { name:"Bangkok Hospital",    lat:12.5532, lon:99.9610 },
      { name:"Night Market",        lat:12.5714, lon:99.9575 },
      { name:"Black Mountain Golf", lat:12.6146, lon:99.8924 },
      { name:"Market Village",      lat:12.5598, lon:99.9602 },
      { name:"Vana Nava",           lat:12.5273, lon:99.9642 },
      { name:"Railway Station",     lat:12.5674, lon:99.9548 },
      { name:"Khao Takiab Beach",   lat:12.5186, lon:99.9774 },
      { name:"Hua Hin Airport",     lat:12.6370, lon:99.9515 },
      { name:"Water Park",          lat:12.6046, lon:99.8897 }
    ];

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ğŸ“– à¸•à¸²à¸£à¸²à¸‡ mapping à¸Šà¸·à¹ˆà¸­à¸ à¸²à¸©à¸²à¸­à¸±à¸‡à¸à¸¤à¸© (à¸ˆà¸²à¸ Spreadsheet) â†’ à¸ à¸²à¸©à¸²à¹„à¸—à¸¢
          à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸Šà¹‰à¸„à¹‰à¸™à¸«à¸²à¹ƒà¸™ Nominatim / OSM à¸‹à¸¶à¹ˆà¸‡à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰à¸Šà¸·à¹ˆà¸­à¹„à¸—à¸¢
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    const SUBDISTRICT_TH = {
      // à¸­à¸³à¹€à¸ à¸­à¸«à¸±à¸§à¸«à¸´à¸™
      'hin lek fai':          'à¸«à¸´à¸™à¹€à¸«à¸¥à¹‡à¸à¹„à¸Ÿ',
      'hin lek fai sub-district': 'à¸«à¸´à¸™à¹€à¸«à¸¥à¹‡à¸à¹„à¸Ÿ',
      'huahin':               'à¸«à¸±à¸§à¸«à¸´à¸™',
      'hua hin':              'à¸«à¸±à¸§à¸«à¸´à¸™',
      'hua hin sub-district': 'à¸«à¸±à¸§à¸«à¸´à¸™',
      'nong kae':             'à¸«à¸™à¸­à¸‡à¹à¸',
      'nong kae sub-district':'à¸«à¸™à¸­à¸‡à¹à¸',
      'thap tai':             'à¸—à¸±à¸šà¹ƒà¸•à¹‰',
      'thap tai sub-district':'à¸—à¸±à¸šà¹ƒà¸•à¹‰',
      'nong phlap':           'à¸«à¸™à¸­à¸‡à¸à¸¥à¸±à¸š',
      'nong phlap sub-district':'à¸«à¸™à¸­à¸‡à¸à¸¥à¸±à¸š',
      'na yang':              'à¸™à¸²à¸¢à¸²à¸‡',
      'na yang sub-district': 'à¸™à¸²à¸¢à¸²à¸‡',
      'nong ta taem':         'à¸«à¸™à¸­à¸‡à¸•à¸²à¹à¸•à¹‰à¸¡',
      'nong ta taem sub-district':'à¸«à¸™à¸­à¸‡à¸•à¸²à¹à¸•à¹‰à¸¡',
      'bueng nakhon':         'à¸šà¸¶à¸‡à¸™à¸„à¸£',
      'bueng nakhon sub-district':'à¸šà¸¶à¸‡à¸™à¸„à¸£',
      // à¸­à¸³à¹€à¸ à¸­à¸›à¸£à¸²à¸“à¸šà¸¸à¸£à¸µ
      'pak nam pran':         'à¸›à¸²à¸à¸™à¹‰à¸³à¸›à¸£à¸²à¸“',
      'pak nam pran sub-district':'à¸›à¸²à¸à¸™à¹‰à¸³à¸›à¸£à¸²à¸“',
      'pranburi':             'à¸›à¸£à¸²à¸“à¸šà¸¸à¸£à¸µ',
      'pranburi sub-district':'à¸›à¸£à¸²à¸“à¸šà¸¸à¸£à¸µ',
      'sam roi yot':          'à¸ªà¸²à¸¡à¸£à¹‰à¸­à¸¢à¸¢à¸­à¸”',
      'sam roi yot sub-district':'à¸ªà¸²à¸¡à¸£à¹‰à¸­à¸¢à¸¢à¸­à¸”',
      'khao noi':             'à¹€à¸‚à¸²à¸™à¹‰à¸­à¸¢',
      'khao noi sub-district':'à¹€à¸‚à¸²à¸™à¹‰à¸­à¸¢',
      'wang phong':           'à¸§à¸±à¸‡à¸à¸‡',
      'wang phong sub-district':'à¸§à¸±à¸‡à¸à¸‡',
      // à¸­à¸³à¹€à¸ à¸­à¸Šà¸°à¸­à¸³
      'cha-am':               'à¸Šà¸°à¸­à¸³',
      'cha am':               'à¸Šà¸°à¸­à¸³',
      'cha-am sub-district':  'à¸Šà¸°à¸­à¸³',
      'bang kao':             'à¸šà¸²à¸‡à¹€à¸à¹ˆà¸²',
      'bang kao sub-district':'à¸šà¸²à¸‡à¹€à¸à¹ˆà¸²',
      'ban laem':             'à¸šà¹‰à¸²à¸™à¹à¸«à¸¥à¸¡',
      'huay sat yai':         'à¸«à¹‰à¸§à¸¢à¸ªà¸±à¸•à¸§à¹Œà¹ƒà¸«à¸à¹ˆ',
      'huai sat yai':         'à¸«à¹‰à¸§à¸¢à¸ªà¸±à¸•à¸§à¹Œà¹ƒà¸«à¸à¹ˆ',
      'huay sat yai sub-district':'à¸«à¹‰à¸§à¸¢à¸ªà¸±à¸•à¸§à¹Œà¹ƒà¸«à¸à¹ˆ',
      'nong sala':            'à¸«à¸™à¸­à¸‡à¸¨à¸²à¸¥à¸²',
      'nong sala sub-district':'à¸«à¸™à¸­à¸‡à¸¨à¸²à¸¥à¸²',
      'yan sue':              'à¸¢à¸²à¸¢à¸ªà¸£à¹‰à¸­à¸¢',
      'yan sue sub-district': 'à¸¢à¸²à¸¢à¸ªà¸£à¹‰à¸­à¸¢',
      'huay sai tai':         'à¸«à¹‰à¸§à¸¢à¹„à¸—à¸£',
      'huay sai tai sub-district':'à¸«à¹‰à¸§à¸¢à¹„à¸—à¸£',
      'huay sai nua':         'à¸«à¹‰à¸§à¸¢à¸—à¸£à¸²à¸¢à¹€à¸«à¸™à¸·à¸­',
      'nong kham':            'à¸«à¸™à¸­à¸‡à¸‚à¸²à¸¡',
      'khao tao':             'à¹€à¸‚à¸²à¹€à¸•à¹ˆà¸²',
      'khao tao sub-district':'à¹€à¸‚à¸²à¹€à¸•à¹ˆà¸²',
      'hin lek fai sub district':'à¸«à¸´à¸™à¹€à¸«à¸¥à¹‡à¸à¹„à¸Ÿ',
    };

    const DISTRICT_TH = {
      'hua hin':          'à¸­.à¸«à¸±à¸§à¸«à¸´à¸™',
      'hua hin district': 'à¸­.à¸«à¸±à¸§à¸«à¸´à¸™',
      'huahin':           'à¸­.à¸«à¸±à¸§à¸«à¸´à¸™',
      'pranburi':         'à¸­.à¸›à¸£à¸²à¸“à¸šà¸¸à¸£à¸µ',
      'pranburi district':'à¸­.à¸›à¸£à¸²à¸“à¸šà¸¸à¸£à¸µ',
      'cha-am':           'à¸­.à¸Šà¸°à¸­à¸³',
      'cha am':           'à¸­.à¸Šà¸°à¸­à¸³',
      'cha-am district':  'à¸­.à¸Šà¸°à¸­à¸³',
      'sam roi yot':      'à¸­.à¸ªà¸²à¸¡à¸£à¹‰à¸­à¸¢à¸¢à¸­à¸”',
      'sam roi yot district':'à¸­.à¸ªà¸²à¸¡à¸£à¹‰à¸­à¸¢à¸¢à¸­à¸”',
      'bang saphan':      'à¸­.à¸šà¸²à¸‡à¸ªà¸°à¸à¸²à¸™',
      'khao yoi':         'à¸­.à¹€à¸‚à¸²à¸¢à¹‰à¸­à¸¢',
    };

    function toThaiSubdistrict(en) {
      if (!en) return '';
      const key = en.trim().toLowerCase();
      return SUBDISTRICT_TH[key] || '';
    }

    function toThaiDistrict(en) {
      if (!en) return '';
      const key = en.trim().toLowerCase();
      return DISTRICT_TH[key] || '';
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    function getDistance(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const dLat = (lat2-lat1)*Math.PI/180, dLon = (lon2-lon1)*Math.PI/180;
      const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
      return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)) * 1.35;
    }

    function safeNum(x) { return parseFloat(String(x||'').replace(/[^0-9.\-]/g,'')) || 0; }

    function parseCoordinates(u) {
      const raw = String(u.Coordinates || '').trim().replace(/[()]/g,'').replace(/\s+/g,'');
      if (!raw || raw === '#') return null;
      const parts = raw.split(',');
      if (parts.length < 2) return null;
      const lat = Number(parts[0]), lon = Number(parts[1]);
      if (!isFinite(lat) || !isFinite(lon) || Math.abs(lat) > 90 || Math.abs(lon) > 180) return null;
      return { lat, lon };
    }

    async function init() {
      if (!hpId) return;
      try {
        const res  = await fetch(`${SCRIPT_URL}?mode=getUnitDetail&id=${encodeURIComponent(hpId)}`);
        const json = await res.json();
        if (json.ok) {
          if (json.data.System_Status && json.data.System_Status !== 'Online') {
            document.getElementById('gatekeeper').style.display = 'flex';
            document.getElementById('mainUI').style.display = 'none';
            hideSplash(); return;
          }
          renderData(json.data);
          hideSplash();
        } else { hideSplash(); }
      } catch(e) { hideSplash(); }
    }

    function hideSplash() {
      const s = document.getElementById('pageSplash');
      if (s) { s.style.opacity='0'; setTimeout(()=>s.style.display='none', 400); }
    }

    function renderData(u) {
      const p = safeNum(u.Sale_Price || 0);
      const a = Math.max(safeNum(u.Living_Area_sq_m || 1), 1);

      document.getElementById('pID').textContent       = u.HP_ID || '-';
      document.getElementById('pPlot').textContent     = `Plot ${u.Plot || '-'}`;
      document.getElementById('pLocText').textContent  = `ğŸ“ ${u.SubDistrict||'-'}, ${u.District||'-'} (${u.Zone||'-'})`;
      document.getElementById('pPrice').textContent    = `à¸¿${Math.round(p).toLocaleString()}`;
      document.getElementById('vBB').textContent       = `${u.Bedrooms||0} Bed | ${u.Bathrooms||0} Bath`;
      document.getElementById('vLiving').textContent   = `${u.Living_Area_sq_m||'-'} mÂ²`;
      document.getElementById('vLand').textContent     = `${u.Land_Area_sq_m||'-'} mÂ²`;
      document.getElementById('vPriceSq').textContent  = `à¸¿${Math.round(p/a).toLocaleString()} / mÂ²`;
      document.getElementById('vFeeM').textContent     = `à¸¿${(safeNum(u.Common_Fee_Rate)||0).toLocaleString()} / mÂ²`;
      document.getElementById('vFeeY').textContent     = `à¸¿${Math.round((safeNum(u.Common_Fee_Rate)||0)*a*12).toLocaleString()} / Yr`;
      document.getElementById('vOwner').textContent    = `${u.Ownership_Type||'-'} (${u.Land_Title_Deed_Type||'-'})`;
      document.getElementById('vTransfer').textContent = u.Transfer_Expenses || '-';
      document.getElementById('vStatus').textContent   = u.Status || '-';
      document.getElementById('vFurnish').textContent  = u.Furnishing || '-';
      document.getElementById('vDistrict').textContent    = u.District || '-';
      document.getElementById('vSubDistrict').textContent = u.SubDistrict || '-';
      document.getElementById('vZone').textContent     = u.Zone || '-';
      document.getElementById('vPoolSys').textContent  = u.Pool_System || '-';
      document.getElementById('vPool').textContent     = `${u.Pool_Size||'-'} (${u.Pool_Depth||'-'})`;
      document.getElementById('vKitchen').textContent  = u.Kitchen_Type || '-';
      document.getElementById('vParking').textContent  = u.Parking || '-';
      document.getElementById('vDirect').textContent   = u.Direction || '-';
      document.getElementById('vUtil').textContent     = `Elec: ${u.Electricity||'-'} | Water: ${u.Water_Source||'-'}`;
      document.getElementById('vDesc').textContent     = u.Description || '-';

      const c = parseCoordinates(u);
      if (c) {
        document.getElementById('mapBox').style.display    = 'block';
        document.getElementById('mapLegend').style.display = 'flex';

        document.getElementById('nearbyGrid').innerHTML = LANDMARKS.map(loc => {
          const d = getDistance(c.lat, c.lon, loc.lat, loc.lon);
          return `<div class="nearby-item">
            <div><div class="loc-name">${loc.name}</div><div class="loc-time">${Math.ceil(d*1.5)} mins drive</div></div>
            <div class="loc-dist">${d.toFixed(1)} km</div>
          </div>`;
        }).join('');

        // à¹à¸›à¸¥à¸‡à¸Šà¸·à¹ˆà¸­ EN â†’ TH à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸Šà¹‰à¸„à¹‰à¸™à¸«à¸²
        const districtEN    = String(u.District    || '').trim();
        const subDistrictEN = String(u.SubDistrict || '').trim();
        const districtTH    = toThaiDistrict(districtEN)    || districtEN;
        const subDistrictTH = toThaiSubdistrict(subDistrictEN) || subDistrictEN;

        initLeafletMap(c.lat, c.lon, districtEN, subDistrictEN, districtTH, subDistrictTH);
      }

      images = u.__album
        || (u.Album_Image ? String(u.Album_Image).split(',').map(x=>x.trim()).filter(Boolean) : []);
      if (!images.length && u.Thumbnail_Image) images = [u.Thumbnail_Image];
      if (images.length) { renderThumbs(); setMain(0); }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ğŸ—ºï¸  LEAFLET MAP â€” NO MARKER, à¹€à¸ªà¹‰à¸™à¸­à¸³à¹€à¸ à¸­(à¹€à¸‚à¸µà¸¢à¸§) + à¸•à¸³à¸šà¸¥(à¹à¸”à¸‡)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    let leafletMap = null;

    async function initLeafletMap(lat, lon, districtEN, subDistrictEN, districtTH, subDistrictTH) {
      if (leafletMap) { leafletMap.remove(); leafletMap = null; }

      leafletMap = L.map('leafletMap', {
        zoomControl: true,
        attributionControl: false,
        scrollWheelZoom: true
      }).setView([lat, lon], 11);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(leafletMap);

      // â”€â”€ 1. District à¹€à¸ªà¹‰à¸™à¹€à¸‚à¸µà¸¢à¸§ (admin_level 6) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const districtBounds = await searchBoundaryAll(
        lat, lon, 6, districtTH, districtEN, 'Prachuap Khiri Khan',
        '#00EE44', 3.5, '12, 7', false
      );

      // â”€â”€ 2. Sub-district à¹€à¸ªà¹‰à¸™à¹à¸”à¸‡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // à¸¥à¸­à¸‡à¸«à¸¥à¸²à¸¢à¸§à¸´à¸˜à¸µ: à¸Šà¸·à¹ˆà¸­à¹„à¸—à¸¢ â†’ à¸Šà¸·à¹ˆà¸­à¸­à¸±à¸‡à¸à¸¤à¸© â†’ à¸à¸´à¸à¸±à¸”
      const subBounds = await searchBoundaryAll(
        lat, lon, 8, subDistrictTH, subDistrictEN, districtTH || districtEN,
        '#FF2222', 5, '9, 6', true
      );

      // â”€â”€ 3. fitBounds â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const best = (subBounds && subBounds.isValid()) ? subBounds
                 : (districtBounds && districtBounds.isValid()) ? districtBounds : null;
      if (best) leafletMap.fitBounds(best, { padding: [22, 22] });
    }

    /**
     * à¸„à¹‰à¸™à¸«à¸² boundary à¸”à¹‰à¸§à¸¢à¸«à¸¥à¸²à¸¢à¸§à¸´à¸˜à¸µà¸•à¸²à¸¡à¸¥à¸³à¸”à¸±à¸š:
     *   1. Overpass is_in (à¸à¸´à¸à¸±à¸”)
     *   2. Overpass around (à¸à¸´à¸à¸±à¸”)
     *   3. Nominatim à¸„à¹‰à¸™à¸Šà¸·à¹ˆà¸­à¹„à¸—à¸¢ â†’ Overpass relation id
     *   4. Nominatim à¸„à¹‰à¸™à¸Šà¸·à¹ˆà¸­à¸­à¸±à¸‡à¸à¸¤à¸© â†’ Overpass relation id
     */
    async function searchBoundaryAll(lat, lon, adminLevel, nameTH, nameEN, parentHint, color, weight, dashArray, outline) {

      // à¸§à¸´à¸˜à¸µ 1: is_in à¸à¸´à¸à¸±à¸”
      let b = await overpassQuery(
        `[out:json][timeout:25];is_in(${lat},${lon})->.a;relation(pivot.a)["boundary"="administrative"]["admin_level"="${adminLevel}"];out geom;`,
        color, weight, dashArray, outline
      );
      if (b) return b;

      // à¸§à¸´à¸˜à¸µ 2: around à¸à¸´à¸à¸±à¸” 500m
      b = await overpassQuery(
        `[out:json][timeout:25];relation(around:500,${lat},${lon})["boundary"="administrative"]["admin_level"="${adminLevel}"];out geom;`,
        color, weight, dashArray, outline
      );
      if (b) return b;

      // à¸§à¸´à¸˜à¸µ 3: Nominatim à¸Šà¸·à¹ˆà¸­à¹„à¸—à¸¢ â†’ Overpass
      if (nameTH) {
        b = await nominatimThenOverpass(nameTH, parentHint, color, weight, dashArray, outline);
        if (b) return b;
      }

      // à¸§à¸´à¸˜à¸µ 4: Nominatim à¸Šà¸·à¹ˆà¸­à¸­à¸±à¸‡à¸à¸¤à¸© â†’ Overpass
      if (nameEN && nameEN !== nameTH) {
        b = await nominatimThenOverpass(nameEN, parentHint, color, weight, dashArray, outline);
        if (b) return b;
      }

      // à¸§à¸´à¸˜à¸µ 5: around à¸à¸´à¸à¸±à¸” à¸à¸§à¹‰à¸²à¸‡à¸‚à¸¶à¹‰à¸™ 5000m
      b = await overpassQuery(
        `[out:json][timeout:25];relation(around:5000,${lat},${lon})["boundary"="administrative"]["admin_level"="${adminLevel}"];out geom;`,
        color, weight, dashArray, outline
      );
      return b || null;
    }

    async function nominatimThenOverpass(name, parentHint, color, weight, dashArray, outline) {
      try {
        const q = [name, parentHint, 'Prachuap Khiri Khan', 'Thailand'].filter(Boolean).join(', ');
        const url = `https://nominatim.openstreetmap.org/search?format=jsonv2&limit=5&q=${encodeURIComponent(q)}`;
        const res = await fetch(url, { headers: { 'Accept': 'application/json' } });
        if (!res.ok) return null;
        const arr = await res.json();
        if (!Array.isArray(arr) || arr.length === 0) return null;

        // à¹€à¸¥à¸·à¸­à¸ relation à¸—à¸µà¹ˆà¸”à¸µà¸—à¸µà¹ˆà¸ªà¸¸à¸”
        const pick = arr.find(x => x.osm_type === 'relation' && (x.class === 'boundary' || x.type === 'administrative'))
                  || arr.find(x => x.osm_type === 'relation')
                  || arr[0];
        if (!pick || !pick.osm_id) return null;

        const relId = Number(pick.osm_id);
        if (!isFinite(relId)) return null;

        return await overpassQuery(
          `[out:json][timeout:25];relation(${relId});out geom;`,
          color, weight, dashArray, outline
        );
      } catch(e) { return null; }
    }

    async function overpassQuery(query, color, weight, dashArray, outline) {
      try {
        const res = await fetch('https://overpass-api.de/api/interpreter', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: 'data=' + encodeURIComponent(query)
        });
        if (!res.ok) return null;

        const data = await res.json();
        if (!data.elements || data.elements.length === 0) return null;

        const allPts = [];
        data.elements.forEach(el => {
          const ways = el.members
            ? el.members.filter(m => m.type === 'way' && m.geometry && m.geometry.length >= 2)
            : (el.type === 'way' && el.geometry ? [el] : []);

          ways.forEach(m => {
            const pts = m.geometry.map(p => [p.lat, p.lon]);
            allPts.push(...pts);

            if (outline) {
              L.polyline(pts, { color:'#FFFFFF', weight:weight+4, opacity:0.5, dashArray, interactive:false }).addTo(leafletMap);
            }
            L.polyline(pts, { color, weight, opacity:1, dashArray, interactive:false }).addTo(leafletMap);
          });
        });

        return allPts.length ? L.latLngBounds(allPts) : null;
      } catch(e) { return null; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ğŸ–¼ï¸  GALLERY (à¹€à¸”à¸´à¸¡ à¹„à¸¡à¹ˆà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function setMain(i) {
      idx = (i + images.length) % images.length;
      const m = document.getElementById('mainImg');
      m.style.opacity = '0';
      setTimeout(() => {
        m.src = images[idx];
        m.style.opacity = '1';
        document.getElementById('countLabel').textContent = `${idx+1} / ${images.length}`;
        document.querySelectorAll('.thumb').forEach((t,k) => t.classList.toggle('active', k===idx));
      }, 150);
    }
    function changeSlide(n) { setMain(idx + n); }
    function renderThumbs() {
      document.getElementById('thumbStrip').innerHTML = images.map((src,i) =>
        `<img class="thumb" src="${src}" onclick="setMain(${i})">`).join('');
    }

    init();
  </script>
</body>
</html>
