<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Hua Hin Properties ¬∑ Details</title>

  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400;1,600&family=Sarabun:wght@300;400;500;600&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>

  <style>
    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       HUAHIN.PROPERTIES ‚Äî DETAILS (FULL)
       Theme matches your index + adds logo palette
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    :root{
      /* Base (index-style) */
      --navy:      #0B1829;
      --navy-mid:  #112238;
      --navy-soft: #1a3350;
      --ocean:     #1B4F72;
      --teal:      #1A7A8A;
      --muted:     #7A9BB5;
      --border:    rgba(255,255,255,0.09);
      --card-bg:   rgba(11,24,41,0.92);

      /* Brand palette (measured from your logo) */
      --brand-maroon: #7F2723;
      --brand-maroon-deep:#78241E;
      --brand-bronze:#9D5E3F;
      --brand-gold:#CEA86C;
      --brand-gold-hi:#EBD18E;
      --brand-cream:#F8F3E2;

      /* Mapping */
      --gold:      var(--brand-gold);
      --gold-lt:   var(--brand-gold-hi);
      --sand:      var(--brand-cream);
      --sand-dim:  #C8B898;
      --white:     #FDFAF5;

      --available: #2ECC8A;
      --reserved:  #E8A020;
      --sold:      #E05555;
      --rented:    #5B9BD5;

      --trans:     0.32s cubic-bezier(0.4,0,0.2,1);
      --px:        18px;
      --px-lg:     52px;
      --radius:    10px;
      --shadow:    0 16px 48px rgba(0,0,0,0.5);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth;-webkit-tap-highlight-color:transparent}
    body{
      background:var(--navy);
      color:var(--sand);
      font-family:'Sarabun',sans-serif;
      font-weight:300;
      min-height:100dvh;
      overflow-x:hidden;
    }

    /* Ocean background like index */
    body::before{
      content:'';
      position:fixed;inset:0;
      background:
        radial-gradient(ellipse 80% 60% at 50% -10%, rgba(27,79,114,0.5) 0%, transparent 60%),
        radial-gradient(ellipse 60% 40% at 100% 80%, rgba(26,122,138,0.2) 0%, transparent 50%),
        radial-gradient(ellipse 50% 50% at 0% 100%, rgba(11,24,41,0.8) 0%, transparent 60%),
        linear-gradient(180deg, #060F1A 0%, #0B1829 40%, #0D1F35 100%);
      pointer-events:none;
      z-index:0;
    }

    body::after{
      content:'';
      position:fixed;bottom:0;left:-50%;
      width:200%;height:200px;
      background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 120'%3E%3Cpath fill='rgba(27,79,114,0.08)' d='M0,60 C360,120 1080,0 1440,60 L1440,120 L0,120 Z'/%3E%3C/svg%3E") repeat-x bottom;
      background-size:800px 120px;
      animation:wave 12s linear infinite;
      pointer-events:none;
      z-index:0;
      opacity:0.6;
    }
    @keyframes wave{from{transform:translateX(0)}to{transform:translateX(50%)}}

    /* Header */
    header{
      position:fixed;top:0;left:0;right:0;z-index:300;
      height:58px;
      display:flex;align-items:center;justify-content:space-between;
      padding:0 var(--px);
      background:rgba(6,15,26,0.88);
      backdrop-filter:blur(20px);
      -webkit-backdrop-filter:blur(20px);
      border-bottom:1px solid var(--border);
    }
    .logo{
      font-family:'Cormorant Garamond',serif;
      font-size:1.1rem;font-weight:400;
      letter-spacing:0.1em;text-transform:uppercase;
      color:var(--gold);text-decoration:none;line-height:1;
    }
    .logo span{color:var(--sand);font-style:italic;font-weight:300}
    .header-nav{display:flex;align-items:center;gap:10px}
    .btn-top{
      padding:9px 16px;
      border-radius:2px;
      border:1px solid rgba(206,168,108,.35);
      background:transparent;
      color:var(--gold);
      font-family:'Montserrat',sans-serif;
      font-size:0.62rem;font-weight:600;
      letter-spacing:0.16em;text-transform:uppercase;
      text-decoration:none;
      transition:all var(--trans);
      white-space:nowrap;
    }
    .btn-top:hover{background:rgba(206,168,108,.14);transform:translateY(-1px)}
    .btn-cta{
      padding:9px 16px;
      border-radius:2px;
      background:linear-gradient(135deg,var(--gold),var(--gold-lt));
      color:var(--navy);
      font-family:'Montserrat',sans-serif;
      font-size:0.62rem;font-weight:700;
      letter-spacing:0.16em;text-transform:uppercase;
      text-decoration:none;
      transition:all var(--trans);
      white-space:nowrap;
      border:1px solid rgba(206,168,108,.25);
    }
    .btn-cta:hover{opacity:.9;transform:translateY(-1px)}

    /* Main */
    main{
      position:relative;z-index:1;
      padding:78px var(--px) 80px;
      max-width:1100px;
      margin:0 auto;
    }

    .err{
      display:none;
      margin:0 0 14px;
      padding:12px 14px;
      background:rgba(224,85,85,.12);
      border:1px solid rgba(224,85,85,.35);
      border-radius:var(--radius);
      color:#ffb1b1;
      font-size:.9rem;
    }

    /* Layout */
    .wrap{
      display:grid;
      grid-template-columns:1fr;
      gap:14px;
    }

    .panel{
      background:var(--card-bg);
      border:1px solid rgba(206,168,108,.22);
      border-radius:var(--radius);
      overflow:hidden;
      box-shadow:var(--shadow);
      backdrop-filter:blur(12px);
    }

    /* Gallery panel */
    .gallery{
      position:relative;
      padding:0;
    }
    .hero-media{
      position:relative;
      width:100%;
      aspect-ratio:16/9;
      background:#060F1A;
      overflow:hidden;
    }
    .hero-media img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      filter:brightness(.92) saturate(1.06);
    }

    /* Light overlay for readability (keep image visible) */
    .hero-shade{
      position:absolute;inset:0;
      background:linear-gradient(
        to bottom,
        rgba(11,24,41,.12) 0%,
        rgba(11,24,41,.08) 45%,
        rgba(11,24,41,.24) 100%
      );
      pointer-events:none;
    }

    /* Nav arrows */
    .navBtn{
      position:absolute;top:50%;
      transform:translateY(-50%);
      width:44px;height:44px;
      border-radius:50%;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(6,15,26,.18); /* thinner */
      backdrop-filter:blur(6px);
      color:rgba(248,243,226,.9);
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;
      transition:all var(--trans);
      user-select:none;
    }
    .navBtn:hover{background:rgba(6,15,26,.28);border-color:rgba(206,168,108,.35)}
    .navBtn:active{transform:translateY(-50%) scale(.98)}
    .navL{left:14px}
    .navR{right:14px}
    .navBtn svg{width:18px;height:18px}

    /* Badge + Status (make thinner / less blocking) */
    .badge{
      position:absolute;top:12px;left:12px;
      padding:6px 10px;
      border-radius:2px;
      background:linear-gradient(135deg,var(--gold),var(--gold-lt));
      color:var(--navy);
      font-family:'Montserrat',sans-serif;
      font-size:0.56rem;
      font-weight:800;
      letter-spacing:0.18em;
      text-transform:uppercase;
      box-shadow:0 10px 26px rgba(0,0,0,.25);
    }
    .statusPill{
      position:absolute;top:12px;right:12px;
      display:flex;align-items:center;gap:8px;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(6,15,26,.18); /* thinner */
      border:1px solid rgba(255,255,255,.14);
      backdrop-filter:blur(6px);
    }
    .dot{width:7px;height:7px;border-radius:50%}
    .lbl{
      font-family:'Montserrat',sans-serif;
      font-size:0.56rem;
      letter-spacing:0.12em;
      text-transform:uppercase;
      color:rgba(248,243,226,.92);
      font-weight:600;
    }
    .d-av{background:var(--available);box-shadow:0 0 8px rgba(46,204,138,.6)}
    .d-rs{background:var(--reserved);box-shadow:0 0 8px rgba(232,160,32,.6)}
    .d-sd{background:var(--sold);box-shadow:0 0 8px rgba(224,85,85,.6)}
    .d-rt{background:var(--rented);box-shadow:0 0 8px rgba(91,155,213,.6)}

    /* Price (REQ: no label, no bar, just number, easy font) */
    .priceOnly{
      position:absolute;left:14px;bottom:14px;
      font-family:'Montserrat',sans-serif;
      font-weight:700;
      font-size:1.06rem;
      letter-spacing:.02em;
      color:rgba(248,243,226,.96);
      text-shadow:0 10px 22px rgba(0,0,0,.65);
      user-select:none;
    }

    /* Counter (REQ: no tab, no "photos", use 1/10, keep size) */
    .counterOnly{
      position:absolute;right:14px;bottom:14px;
      font-family:'Montserrat',sans-serif;
      font-weight:600;
      font-size:0.72rem; /* similar visual size to your current */
      letter-spacing:.14em;
      text-transform:uppercase;
      color:rgba(248,243,226,.9);
      text-shadow:0 10px 22px rgba(0,0,0,.65);
      user-select:none;
    }

    /* Thumbnails row */
    .thumbRow{
      display:flex;
      gap:10px;
      padding:12px 12px 14px;
      overflow-x:auto;
      scrollbar-width:none;
      background:rgba(6,15,26,.25);
      border-top:1px solid rgba(255,255,255,.07);
    }
    .thumbRow::-webkit-scrollbar{display:none}
    .thumb{
      width:112px;
      aspect-ratio:16/10;
      border-radius:10px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      flex-shrink:0;
      cursor:pointer;
      position:relative;
      transition:transform var(--trans),border-color var(--trans),box-shadow var(--trans);
      background:#060F1A;
    }
    .thumb img{width:100%;height:100%;object-fit:cover;display:block;filter:brightness(.95)}
    .thumb.active{
      border-color:rgba(206,168,108,.55);
      box-shadow:0 0 0 2px rgba(206,168,108,.15);
      transform:translateY(-1px);
    }

    /* Details panel */
    .info{
      padding:18px 16px 16px;
    }
    .kicker{
      font-family:'Montserrat',sans-serif;
      font-size:.58rem;
      letter-spacing:.28em;
      text-transform:uppercase;
      color:var(--teal);
      margin-bottom:10px;
      opacity:.9;
    }
    .title{
      font-family:'Cormorant Garamond',serif;
      font-size:2rem;
      font-weight:300;
      line-height:1.1;
      color:var(--white);
      margin-bottom:10px;
    }
    .loc{
      display:flex;align-items:center;gap:10px;
      color:rgba(122,155,181,.95);
      font-size:.95rem;
      margin-bottom:12px;
    }
    .tags{
      display:flex;flex-wrap:wrap;gap:8px;
      margin:10px 0 14px;
    }
    .tag{
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(6,15,26,.22);
      color:rgba(248,243,226,.82);
      font-family:'Montserrat',sans-serif;
      font-size:.58rem;
      letter-spacing:.16em;
      text-transform:uppercase;
    }

    .gridSpecs{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:10px;
      margin-top:10px;
    }
    .specBox{
      padding:14px 14px 12px;
      border-radius:14px;
      border:1px solid rgba(206,168,108,.18);
      background:rgba(6,15,26,.22);
      min-height:72px;
    }
    .specLbl{
      font-family:'Montserrat',sans-serif;
      font-size:.56rem;
      letter-spacing:.22em;
      text-transform:uppercase;
      color:rgba(206,168,108,.8);
      margin-bottom:6px;
    }
    .specVal{
      font-family:'Sarabun',sans-serif;
      font-size:1.05rem;
      color:rgba(248,243,226,.92);
    }
    .specVal small{opacity:.75;font-size:.9rem}

    .section{
      margin-top:14px;
      padding-top:14px;
      border-top:1px solid rgba(255,255,255,.08);
    }
    .secTitle{
      font-family:'Montserrat',sans-serif;
      font-size:.62rem;
      letter-spacing:.26em;
      text-transform:uppercase;
      color:rgba(206,168,108,.9);
      margin-bottom:10px;
    }
    .text{
      color:rgba(122,155,181,.95);
      font-size:.95rem;
      line-height:1.75;
      white-space:pre-line;
    }

    /* Contact panel (REQ: moved down below property details) */
    .contact{
      padding:16px;
    }
    .contactGrid{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:10px;
      margin-top:10px;
    }
    .cbtn{
      display:flex;align-items:center;justify-content:center;
      height:46px;
      border-radius:10px;
      text-decoration:none;
      font-family:'Montserrat',sans-serif;
      font-size:.62rem;
      letter-spacing:.22em;
      text-transform:uppercase;
      transition:all var(--trans);
      border:1px solid rgba(206,168,108,.22);
      background:rgba(6,15,26,.18);
      color:rgba(248,243,226,.9);
      backdrop-filter:blur(10px);
    }
    .cbtn:hover{transform:translateY(-1px);border-color:rgba(206,168,108,.45);background:rgba(206,168,108,.10)}
    .cbtn.primary{
      background:linear-gradient(135deg,var(--gold),var(--gold-lt));
      color:var(--navy);
      border-color:rgba(206,168,108,.22);
      font-weight:700;
    }
    .contactNote{
      margin-top:10px;
      font-size:.85rem;
      color:rgba(122,155,181,.9);
      line-height:1.6;
    }

    /* Map button */
    .mapRow{
      display:flex;gap:10px;flex-wrap:wrap;
      margin-top:10px;
    }
    .linkBtn{
      display:inline-flex;align-items:center;gap:10px;
      padding:11px 12px;
      border-radius:12px;
      border:1px solid rgba(206,168,108,.20);
      background:rgba(6,15,26,.18);
      color:rgba(248,243,226,.9);
      text-decoration:none;
      font-family:'Montserrat',sans-serif;
      font-size:.62rem;
      letter-spacing:.16em;
      text-transform:uppercase;
      transition:all var(--trans);
    }
    .linkBtn:hover{border-color:rgba(206,168,108,.45);background:rgba(206,168,108,.10);transform:translateY(-1px)}
    .linkBtn svg{width:16px;height:16px;opacity:.9}

    /* Responsive */
    @media(min-width:900px){
      header{padding:0 var(--px-lg)}
      main{padding:86px var(--px-lg) 100px}
      .wrap{grid-template-columns:1.25fr .75fr;align-items:start}
      .info{padding:18px}
      .gridSpecs{grid-template-columns:repeat(2,1fr)}
    }
    @media(max-width:420px){
      .title{font-size:1.75rem}
      .gridSpecs{grid-template-columns:repeat(2,1fr)}
      .thumb{width:104px}
    }
  </style>
</head>

<body>
  <header>
    <a href="index.html" class="logo">Hua Hin<span>.Properties</span></a>
    <div class="header-nav">
      <a href="index.html" class="btn-top">‚Üê Back</a>
      <a href="#contact" class="btn-cta">Contact</a>
    </div>
  </header>

  <main>
    <div class="err" id="errBox">‚ö† ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‚Äî ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö SCRIPT_URL / Deploy / Permission ‡πÅ‡∏•‡∏∞‡πÇ‡∏´‡∏°‡∏î getUnitDetail</div>

    <div class="wrap">
      <!-- LEFT: GALLERY -->
      <section class="panel gallery" aria-label="Gallery">
        <div class="hero-media">
          <img id="heroImg" alt="Property photo" loading="eager" />
          <div class="hero-shade"></div>

          <button class="navBtn navL" id="btnPrev" aria-label="Previous photo">
            <svg viewBox="0 0 24 24" fill="none"><path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
          <button class="navBtn navR" id="btnNext" aria-label="Next photo">
            <svg viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>

          <div class="badge" id="badge" style="display:none"></div>

          <div class="statusPill" id="statusPill">
            <span class="dot d-av" id="statusDot"></span>
            <span class="lbl" id="statusLbl">‚Äî</span>
          </div>

          <!-- REQ: only price number, no label/tab -->
          <div class="priceOnly" id="priceOnly">‚Äî</div>

          <!-- REQ: no tab, no word photos, use 1/10 -->
          <div class="counterOnly" id="counterOnly">‚Äî</div>
        </div>

        <div class="thumbRow" id="thumbRow"></div>
      </section>

      <!-- RIGHT: DETAILS -->
      <section class="panel">
        <div class="info">
          <div class="kicker" id="propIdLine">PROPERTY</div>
          <div class="title" id="title">‚Äî</div>
          <div class="loc" id="loc">üìç ‚Äî</div>

          <div class="tags" id="tags"></div>

          <div class="gridSpecs">
            <div class="specBox">
              <div class="specLbl">Bedrooms</div>
              <div class="specVal" id="vBeds">‚Äî</div>
            </div>
            <div class="specBox">
              <div class="specLbl">Bathrooms</div>
              <div class="specVal" id="vBaths">‚Äî</div>
            </div>
            <div class="specBox">
              <div class="specLbl">Living Area</div>
              <div class="specVal" id="vLiving">‚Äî</div>
            </div>
            <div class="specBox">
              <div class="specLbl">Land</div>
              <div class="specVal" id="vLand">‚Äî</div>
            </div>
            <div class="specBox">
              <div class="specLbl">Pool</div>
              <div class="specVal" id="vPool">‚Äî</div>
            </div>
            <div class="specBox">
              <div class="specLbl">Ownership</div>
              <div class="specVal" id="vOwner">‚Äî</div>
            </div>
          </div>

          <div class="section">
            <div class="secTitle">Key Selling Points</div>
            <div class="text" id="ksp">‚Äî</div>
          </div>

          <div class="section">
            <div class="secTitle">Description</div>
            <div class="text" id="desc">‚Äî</div>
          </div>

          <div class="section">
            <div class="secTitle">Links</div>
            <div class="mapRow" id="linkRow"></div>
          </div>
        </div>
      </section>
    </div>

    <!-- CONTACT moved DOWN (REQ #4) -->
    <section class="panel contact" id="contact" style="margin-top:14px">
      <div class="kicker">CONTACT</div>
      <div class="contactGrid">
        <a class="cbtn primary" id="btnLine" href="https://line.me/R/ti/p/@qap7218t" target="_blank" rel="noopener">LINE OA</a>
        <a class="cbtn" id="btnWa" href="https://wa.me/66805820777?text=Interested" target="_blank" rel="noopener">WhatsApp</a>
        <a class="cbtn" id="btnFb" href="https://m.me/huahinpropertyhuahinrealestate/" target="_blank" rel="noopener">Facebook</a>
        <a class="cbtn" id="btnCall" href="tel:+66805820777">Call</a>
      </div>
      <div class="contactNote" id="contactNote">
        ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î / ‡∏ô‡∏±‡∏î‡∏ä‡∏°‡∏ö‡πâ‡∏≤‡∏ô (‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà)
      </div>
    </section>
  </main>

  <script>
    // ==========================================================
    // CONFIG ‚Äî YOUR VALUES
    // ==========================================================
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyOnZc6s05eGvHR5XmRnRPAat8vNZpf8cFhL2GiAFjWld-2OBf2OqgP07RU07UTZgDXxA/exec";
    const SHEET_ID   = "1vFsPw6GRO8kd_vHDhbV-Y-t11WTOfyv0E18TH0Nuy74";
    const SHEET_NAME = "properties";
    const SHEET_URL  = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;

    // ==========================================================
    // STATE
    // ==========================================================
    const qs = new URLSearchParams(location.search);
    const HP_ID = (qs.get("id") || qs.get("HP_ID") || "").trim();

    let photos = [];
    let idx = 0;
    let current = null;

    // ==========================================================
    // HELPERS
    // ==========================================================
    const $ = (id)=>document.getElementById(id);

    function showErr(msg){
      const box = $("errBox");
      box.textContent = "‚ö† " + msg;
      box.style.display = "block";
    }
    function hideErr(){ $("errBox").style.display = "none"; }

    function safeStr(v){ return (v==null) ? "" : String(v).trim(); }

    function dotCls(s){
      return { Available:"d-av", Reserved:"d-rs", Sold:"d-sd", Rented:"d-rt" }[s] || "d-av";
    }

    function parseMoney(s){
      const t = safeStr(s).replace(/,/g,"");
      const n = parseFloat(t.replace(/[^\d.]/g,""));
      return isFinite(n) ? n : 0;
    }

    function fmtBahtFull(n){
      if(!n) return "‚Äî";
      return "‡∏ø" + new Intl.NumberFormat("en-US").format(Math.round(n));
    }

    function normalizeImageUrl(u){
      let s = safeStr(u);
      if(!s) return "";

      // if already lh3 direct
      if(/^https:\/\/lh3\.googleusercontent\.com\/d\//i.test(s)) return s;

      // drive file view
      const m1 = s.match(/drive\.google\.com\/file\/d\/([a-zA-Z0-9_-]+)/);
      if(m1) return "https://lh3.googleusercontent.com/d/" + m1[1];

      // open?id=
      const m2 = s.match(/open\?id=([a-zA-Z0-9_-]+)/);
      if(m2) return "https://lh3.googleusercontent.com/d/" + m2[1];

      // raw file id (looks like)
      if(/^[a-zA-Z0-9_-]{20,}$/.test(s)) return "https://lh3.googleusercontent.com/d/" + s;

      return s;
    }

    function splitAlbum(s){
      const raw = safeStr(s);
      if(!raw) return [];
      return raw
        .split(/[,\n]/g)
        .map(x=>normalizeImageUrl(x))
        .map(x=>x.trim())
        .filter(Boolean);
    }

    function choosePrice(p){
      const lt = safeStr(p["Listing_Type"]) || "Sale";
      const sale = parseMoney(p["Sale_Price"]);
      const rent = parseMoney(p["Monthly_Rent"]);

      if(lt.toLowerCase().includes("rent")){
        return rent ? (fmtBahtFull(rent) + "/mo") : (sale ? fmtBahtFull(sale) : "‚Äî");
      }
      // Sale or Sale/Rent
      if(sale) return fmtBahtFull(sale);
      if(rent) return fmtBahtFull(rent) + "/mo";
      return "‚Äî";
    }

    function tag(text){
      const t = document.createElement("span");
      t.className = "tag";
      t.textContent = text;
      return t;
    }

    function addLinkBtn(container, label, href, icon){
      const a = document.createElement("a");
      a.className = "linkBtn";
      a.href = href;
      a.target = "_blank";
      a.rel = "noopener";
      a.innerHTML = `${icon}${label}`;
      container.appendChild(a);
    }

    // ==========================================================
    // RENDER
    // ==========================================================
    function setHero(i){
      if(!photos.length){
        $("heroImg").src = "";
        $("counterOnly").textContent = "‚Äî";
        return;
      }
      idx = (i + photos.length) % photos.length;
      $("heroImg").src = photos[idx];
      $("counterOnly").textContent = `${idx+1}/${photos.length}`;
      updateThumbActive();
    }

    function updateThumbActive(){
      const row = $("thumbRow");
      [...row.children].forEach((el, k)=>{
        el.classList.toggle("active", k===idx);
      });
    }

    function renderThumbs(){
      const row = $("thumbRow");
      row.innerHTML = "";
      if(!photos.length) return;

      photos.forEach((src, i)=>{
        const t = document.createElement("div");
        t.className = "thumb" + (i===0 ? " active" : "");
        t.innerHTML = `<img src="${src}" alt="thumb ${i+1}" loading="lazy">`;
        t.addEventListener("click", ()=>setHero(i));
        row.appendChild(t);
      });
    }

    function render(p){
      current = p;

      const id = safeStr(p["HP_ID"]) || HP_ID || "‚Äî";
      const proj = safeStr(p["Project_Name"]);
      const type = safeStr(p["Type"]);
      const zone = safeStr(p["Zone"]) || safeStr(p["District"]) || "";
      const dist = safeStr(p["District"]) || "";
      const subd = safeStr(p["SubDistrict"]) || "";
      const status = safeStr(p["Status"]) || "Available";
      const badge = safeStr(p["Badge"]);
      const view = safeStr(p["View_Type"]);
      const deed = safeStr(p["Land_Title_Deed_Type"]);
      const own = safeStr(p["Ownership_Type"]);
      const lt = safeStr(p["Listing_Type"]);

      $("propIdLine").textContent = `PROPERTY ID ¬∑ ${id}`;
      $("title").textContent = [proj, type].filter(Boolean).join(" ¬∑ ") || "‚Äî";
      $("loc").textContent = `üìç ${[zone, subd, dist].filter(Boolean).join(" ¬∑ ") || "‚Äî"}`;

      // Status pill
      $("statusLbl").textContent = status || "‚Äî";
      $("statusDot").className = "dot " + dotCls(status);

      // Badge
      if(badge){
        $("badge").style.display = "inline-block";
        $("badge").textContent = badge;
      }else{
        $("badge").style.display = "none";
      }

      // Price (REQ: only number)
      $("priceOnly").textContent = choosePrice(p);

      // Tags
      const tags = $("tags");
      tags.innerHTML = "";
      if(lt) tags.appendChild(tag(lt));
      if(status) tags.appendChild(tag(status));
      if(view) tags.appendChild(tag(view));
      if(deed) tags.appendChild(tag(deed));
      if(own) tags.appendChild(tag(own));

      // Specs
      $("vBeds").textContent  = safeStr(p["Bedrooms"]) || "‚Äî";
      $("vBaths").textContent = safeStr(p["Bathrooms"]) || "‚Äî";

      const living = safeStr(p["Living_Area_sq_m"]);
      $("vLiving").innerHTML = living ? `${living} <small>m¬≤</small>` : "‚Äî";

      const lw = safeStr(p["Land_Area_sq_w"]);
      const lm = safeStr(p["Land_Area_sq_m"]);
      $("vLand").innerHTML = (lw || lm)
        ? `${lw ? lw + " <small>sq.w</small>" : ""}${(lw && lm) ? " ¬∑ " : ""}${lm ? lm + " <small>m¬≤</small>" : ""}`
        : "‚Äî";

      const ps = safeStr(p["Pool_Size"]);
      const pd = safeStr(p["Pool_Depth"]);
      $("vPool").innerHTML = (ps || pd)
        ? `${ps || "‚Äî"}${(ps && pd) ? " ¬∑ " : ""}${pd || ""}`
        : "‚Äî";

      const transfer = safeStr(p["Transfer_Expenses"]);
      $("vOwner").textContent = [own, transfer].filter(Boolean).join(" ¬∑ ") || "‚Äî";

      // Text
      $("ksp").textContent  = safeStr(p["Key_Selling_Points"]) || "‚Äî";
      $("desc").textContent = safeStr(p["Description"]) || "‚Äî";

      // Links
      const linkRow = $("linkRow");
      linkRow.innerHTML = "";
      const map = safeStr(p["Map_Link"]);
      const vt  = safeStr(p["Virtual_Tour"]);
      const fb  = safeStr(p["FB_Link"]);
      const vid = safeStr(p["Video_Link"]);
      const fp  = safeStr(p["FloorPlan_PDF"]);
      const mp  = safeStr(p["Material_PDF"]);

      const icoLink = `<svg viewBox="0 0 24 24" fill="none"><path d="M10 13a5 5 0 007.07 0l1.41-1.41a5 5 0 00-7.07-7.07L10.5 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M14 11a5 5 0 01-7.07 0L5.52 9.59a5 5 0 017.07-7.07L13.5 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>`;
      const icoMap  = `<svg viewBox="0 0 24 24" fill="none"><path d="M12 21s7-4.35 7-11a7 7 0 10-14 0c0 6.65 7 11 7 11z" stroke="currentColor" stroke-width="2"/><path d="M12 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z" stroke="currentColor" stroke-width="2"/></svg>`;
      const icoPlay = `<svg viewBox="0 0 24 24" fill="none"><path d="M8 5v14l11-7L8 5z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>`;
      const icoPdf  = `<svg viewBox="0 0 24 24" fill="none"><path d="M7 3h7l3 3v15H7V3z" stroke="currentColor" stroke-width="2"/><path d="M14 3v4h4" stroke="currentColor" stroke-width="2"/></svg>`;

      if(map) addLinkBtn(linkRow, "Map", map, icoMap);
      if(vt)  addLinkBtn(linkRow, "Virtual Tour", vt, icoPlay);
      if(fb)  addLinkBtn(linkRow, "Facebook", fb, icoLink);
      if(vid) addLinkBtn(linkRow, "Video", vid, icoPlay);
      if(fp)  addLinkBtn(linkRow, "Floorplan", fp, icoPdf);
      if(mp)  addLinkBtn(linkRow, "Material", mp, icoPdf);

      // Album photos
      const album = splitAlbum(p["Album_Image"]);
      const thumb = normalizeImageUrl(p["Thumbnail_Image"]);

      photos = album.length ? album : (thumb ? [thumb] : []);
      renderThumbs();
      setHero(0);

      // Contact URLs (optional: override per listing)
      // keep your defaults, but if sheet has custom links -> use them
      // (FB_Link already used in Links; contact box stays your standard channels)
    }

    // ==========================================================
    // FETCH DETAIL
    // ==========================================================
    async function fetchDetailFromScript(){
      // Support common parameter names
      const url1 = `${SCRIPT_URL}?mode=getUnitDetail&id=${encodeURIComponent(HP_ID)}`;
      const url2 = `${SCRIPT_URL}?mode=getUnitDetail&HP_ID=${encodeURIComponent(HP_ID)}`;

      let r = await fetch(url1, { signal: AbortSignal.timeout(9000) }).catch(()=>null);
      if(!r || !r.ok){
        r = await fetch(url2, { signal: AbortSignal.timeout(9000) }).catch(()=>null);
      }
      if(!r || !r.ok) throw new Error("SCRIPT_FETCH_FAILED");

      const j = await r.json();
      // Accept several shapes
      const data = j?.data || j?.row || j?.item || j;
      if(!data || typeof data !== "object") throw new Error("SCRIPT_BAD_JSON");
      return data;
    }

    async function fetchDetailFromSheet(){
      const r = await fetch(SHEET_URL, { signal: AbortSignal.timeout(9000) });
      const t = await r.text();
      const j = JSON.parse(t.slice(t.indexOf("{"), t.lastIndexOf("}") + 1));
      const cols = j.table.cols.map(c=>c.label);

      const rows = j.table.rows.map(row=>{
        const o = {};
        cols.forEach((c,i)=>{
          o[c] = row.c?.[i]?.v != null ? String(row.c[i].v) : "";
        });
        return o;
      });

      const found = rows.find(x => safeStr(x["HP_ID"]) === HP_ID);
      if(!found) throw new Error("NOT_FOUND_IN_SHEET");
      return found;
    }

    async function start(){
      if(!HP_ID){
        showErr("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå id ‡πÉ‡∏ô URL ‡πÄ‡∏ä‡πà‡∏ô details.html?id=HP00-0001");
        return;
      }
      try{
        hideErr();
        const data = await fetchDetailFromScript();
        render(data);
      }catch(e1){
        try{
          const data2 = await fetchDetailFromSheet();
          render(data2);
        }catch(e2){
          showErr("‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‚Äî ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Apps Script Deploy ‡πÄ‡∏õ‡πá‡∏ô Anyone ‡πÅ‡∏•‡∏∞‡πÇ‡∏´‡∏°‡∏î getUnitDetail ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ / ‡∏´‡∏£‡∏∑‡∏≠ Sheet ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô Public");
        }
      }
    }

    // ==========================================================
    // EVENTS
    // ==========================================================
    $("btnPrev").addEventListener("click", ()=> setHero(idx - 1));
    $("btnNext").addEventListener("click", ()=> setHero(idx + 1));

    // Keyboard support (desktop)
    window.addEventListener("keydown", (e)=>{
      if(e.key==="ArrowLeft") setHero(idx-1);
      if(e.key==="ArrowRight") setHero(idx+1);
    });

    // Touch swipe (mobile)
    (function(){
      const el = document.querySelector(".hero-media");
      let x0 = null;
      el.addEventListener("touchstart", (e)=>{ x0 = e.touches[0].clientX; }, {passive:true});
      el.addEventListener("touchend", (e)=>{
        if(x0==null) return;
        const x1 = e.changedTouches[0].clientX;
        const dx = x1 - x0;
        x0 = null;
        if(Math.abs(dx) < 38) return;
        if(dx > 0) setHero(idx-1); else setHero(idx+1);
      }, {passive:true});
    })();

    start();
  </script>
</body>
</html>
