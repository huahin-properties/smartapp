<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <title>Asset Specifications | MASTER SYSTEM V168</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600;700;800&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    :root{--navy:#0B1829;--navy-dark:#060F1A;--gold:#C9A84C;--border:rgba(201,168,76,0.15);--card-bg:#0F172A;--pdf-red: #E02424;}
    *{box-sizing:border-box;margin:0;padding:0}
    body{background-color:var(--navy-dark);color:#FDFAF5;font-family:'Montserrat',sans-serif;-webkit-font-smoothing:antialiased}
    #gatekeeper{position:fixed;inset:0;background:var(--navy-dark);z-index:10001;display:none;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:40px}
    #pageSplash{position:fixed;inset:0;background:var(--navy-dark);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10000;transition:opacity 0.4s}
    .splash-brand{color:var(--gold);font-size:1.2rem;font-weight:800;letter-spacing:4px;text-transform:uppercase}
    header{position:fixed;top:0;width:100%;height:55px;background:rgba(11,24,41,0.95);backdrop-filter:blur(10px);z-index:1000;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 15px}
    .back{text-decoration:none;color:var(--gold);font-size:0.7rem;font-weight:700;text-transform:uppercase;letter-spacing:1.5px}
    .gallery-container{margin-top:65px;padding:0 15px;max-width:1100px;margin:0 auto}
    .gallery-card{background:#000;border-radius:18px;border:1px solid var(--border);overflow:hidden;box-shadow:0 15px 35px rgba(0,0,0,0.3);margin-bottom:20px}
    .main-stage{position:relative;width:100%;aspect-ratio:16/10;background:#000;overflow:hidden}
    .main-img{width:100%;height:100%; object-fit:cover; transition:opacity 0.3s}
    .nav-arrow{position:absolute;top:50%;transform:translateY(-50%);width:44px;height:44px;border-radius:50%;background:rgba(0,0,0,0.3);color:white;border:1px solid rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:10}
    .thumb-row{display:flex;gap:10px;padding:12px;overflow-x:auto;scrollbar-width:none}
    .thumb{width:90px;aspect-ratio:16/10;border-radius:8px;object-fit:cover;opacity:0.5;cursor:pointer;border:2px solid transparent;flex-shrink:0;transition:0.2s}
    .thumb.active{opacity:1;border-color:var(--gold)}
    .tag-count{position:absolute;right:15px;bottom:15px;background:rgba(0,0,0,0.6);color:white;padding:4px 10px;border-radius:50px;font-size:10px;font-weight:600}
    .content{padding:10px 15px 120px;max-width:900px;margin:0 auto}
    .info-card{background:var(--card-bg);border-radius:12px;padding:22px;margin-bottom:15px;border:1px solid var(--border)}
    .section-title{font-size:0.65rem;font-weight:700;color:var(--gold);text-transform:uppercase;letter-spacing:2px;margin-bottom:18px;display:flex;align-items:center;gap:8px}
    .section-title::after{content:'';flex:1;height:1px;background:var(--border)}
    .label{font-size:0.55rem;color:#7A9BB5;text-transform:uppercase;font-weight:500;letter-spacing:1.2px;margin-bottom:3px}
    .val{font-size:0.85rem;font-weight:400;color:#FFF}
    .gold-txt{color:var(--gold);font-weight:600}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:15px}
    .nearby-item{display:flex;justify-content:space-between;padding:10px 0;border-bottom:0.5px solid var(--border)}
    .loc-name{font-size:0.78rem;font-weight:300}
    .loc-dist{font-size:0.75rem;font-weight:400;color:var(--gold)}
    .map-box{width:100%;aspect-ratio:1/1;max-height:500px;border-radius:12px;overflow:hidden;border:1px solid var(--border);margin:10px 0}
    #leafletMap{width:100%;height:100%;background:#0F172A}
    .leaflet-control-attribution{display:none!important}
    .map-legend{display:flex;gap:20px;margin-bottom:8px}
    .map-legend-item{display:flex;align-items:center;gap:7px;font-size:0.62rem;color:#9AB;font-weight:600;letter-spacing:1.2px;text-transform:uppercase}
    .legend-line{width:32px;height:4px;border-radius:2px}
    .legend-red{background:repeating-linear-gradient(to right,#FF2222 0,#FF2222 8px,transparent 8px,transparent 13px)}
    .legend-green{background:repeating-linear-gradient(to right,#00EE44 0,#00EE44 11px,transparent 11px,transparent 17px)}

    /* üéØ ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÅ‡∏ñ‡∏ö‡∏ö‡∏≤‡∏£‡πå PDF ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏°‡∏≤‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå */
    .pdf-download-bar { display: none; background: #FFFFFF; border: 1.5px solid var(--border); padding: 18px 20px; border-radius: 15px; text-decoration: none; align-items: center; justify-content: space-between; margin-top: 10px; transition: 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
    .pdf-download-bar:active { transform: scale(0.98); background: #F3F6F3; }
    .pdf-label { color: var(--navy); font-weight: 800; font-size: 0.82rem; text-transform: uppercase; letter-spacing: 1px; }
    .pdf-icon-red { color: var(--pdf-red); font-size: 1.4rem; }

    .footer{position:fixed;bottom:0;width:100%;background:#060F1A;padding:12px 15px;border-top:1px solid var(--border);z-index:1000}
    .btn-chat{background:var(--gold);color:#060F1A;text-decoration:none;padding:15px;border-radius:4px;display:block;text-align:center;font-size:0.88rem;letter-spacing:2px;text-transform:uppercase;font-weight:800}
    @media(min-width:768px){.nearby-grid{display:grid;grid-template-columns:1fr 1fr;gap:0 30px}}
  </style>
</head>
<body>
<div id="gatekeeper">
  <i class="fas fa-lock" style="font-size:50px;color:var(--gold);margin-bottom:20px;"></i>
  <h2 style="color:var(--gold);font-weight:800;margin-bottom:10px;">ASSET UNAVAILABLE</h2>
  <p style="color:#7A9BB5;font-size:0.8rem;margin-bottom:30px;">This property has been taken offline or is under review.</p>
  <a href="index.html" style="background:var(--gold);color:#060F1A;padding:12px 30px;border-radius:50px;font-weight:800;text-decoration:none;text-transform:uppercase;font-size:11px;">Back to Catalog</a>
</div>
<div id="pageSplash"><div class="splash-brand">MASTER CATALOG</div></div>
<header>
  <a href="index.html" class="back">‚úï Close</a>
  <div style="font-weight:800;color:var(--gold);">MASTER CATALOG</div>
  <div style="width:40px;"></div>
</header>
<div id="mainUI">
  <div class="gallery-container">
    <div class="gallery-card">
      <div class="main-stage">
        <img id="mainImg" class="main-img" src="">
        <div class="nav-arrow" style="left:10px" onclick="changeSlide(-1)">‚ùÆ</div>
        <div class="nav-arrow" style="right:10px" onclick="changeSlide(1)">‚ùØ</div>
        <div class="tag-count" id="countLabel">0 / 0</div>
      </div>
      <div class="thumb-row" id="thumbStrip"></div>
    </div>
  </div>
  <main class="content">
    <div class="info-card">
      <div style="font-size:0.6rem;color:var(--gold);font-weight:800;margin-bottom:5px;" id="pID">HP-XXXX</div>
      <h1 id="pPlot" style="font-family:'Playfair Display',serif;font-size:1.8rem;color:var(--gold);margin-bottom:5px;font-weight:800;">Plot ...</h1>
      <div id="pLocText" style="font-size:0.75rem;color:#7A9BB5;margin-bottom:20px;">üìç -</div>
      <div id="pPrice" style="font-size:1.4rem;font-weight:700;color:#FFF;margin-bottom:20px;">‡∏ø0</div>
      <div class="grid">
        <div><div class="label">Bed / Bath</div><div class="val" id="vBB">-</div></div>
        <div><div class="label">Living Area</div><div class="val" id="vLiving">-</div></div>
        <div><div class="label">Land Size</div><div class="val" id="vLand">-</div></div>
        <div><div class="label">Price per Sq.m</div><div class="val gold-txt" id="vPriceSq">-</div></div>
      </div>
    </div>
    <div class="info-card">
      <h2 class="section-title">Specifications</h2>
      <div class="grid">
        <div><div class="label">Status</div><div class="val" id="vStatus">-</div></div>
        <div><div class="label">Furnishing</div><div class="val" id="vFurnish">-</div></div>
        <div><div class="label">District</div><div class="val" id="vDistrict">-</div></div>
        <div><div class="label">Sub-district</div><div class="val" id="vSubDistrict">-</div></div>
        <div><div class="label">Zone</div><div class="val gold-txt" id="vZone">-</div></div>
        <div><div class="label">Pool System</div><div class="val" id="vPoolSys">-</div></div>
        <div><div class="label">Pool Info</div><div class="val" id="vPool">-</div></div>
        <div><div class="label">Kitchen Type</div><div class="val" id="vKitchen">-</div></div>
        <div><div class="label">Parking</div><div class="val" id="vParking">-</div></div>
        <div><div class="label">Direction</div><div class="val" id="vDirect">-</div></div>
        <div class="col-span-full"><div class="label">Utility Info</div><div class="val" id="vUtil">-</div></div>
      </div>
    </div>
    <div class="info-card" style="border-left:4px solid var(--gold);">
      <h2 class="section-title">Ownership & Fees</h2>
      <div class="grid">
        <div><div class="label">Monthly Fee</div><div class="val" id="vFeeM">-</div></div>
        <div><div class="label">Yearly Total</div><div class="val gold-txt" id="vFeeY">-</div></div>
        <div><div class="label">Ownership</div><div class="val" id="vOwner">-</div></div>
        <div><div class="label">Transfer Exp.</div><div class="val" id="vTransfer">-</div></div>
      </div>
    </div>
    <div class="info-card">
      <h2 class="section-title">Description</h2>
      <p id="vDesc" style="font-size:0.82rem;line-height:1.8;color:#CCC;font-weight:300;white-space:pre-line;">-</p>
    </div>
    <div class="info-card">
      <h2 class="section-title">Location & Navigation</h2>
      <div class="map-legend" id="mapLegend" style="display:none;">
        <div class="map-legend-item"><div class="legend-line legend-red"></div> Sub-district</div>
        <div class="map-legend-item"><div class="legend-line legend-green"></div> District</div>
      </div>
      <div class="map-box" id="mapBox" style="display:none;">
        <div id="leafletMap"></div>
      </div>
    </div>
    <div class="info-card">
      <h2 class="section-title">Nearby Lifestyle & Amenities</h2>
      <div id="nearbyGrid" class="nearby-grid"></div>
      
      <a id="pdfBarMaster" href="#" target="_blank" class="pdf-download-bar">
        <span class="pdf-label">Download Floor Plan PDF</span>
        <i class="fas fa-file-pdf pdf-icon-red"></i>
      </a>
    </div>
  </main>
</div>
<div class="footer">
  <a href="https://line.me/R/ti/p/@qap7218t" class="btn-chat">üí¨ Live Chat Concierge</a>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const SCRIPT_URL='https://script.google.com/macros/s/AKfycbyOnZc6s05eGvHR5XmRnRPAat8vNZpf8cFhL2GiAFjWld-2OBf2OqgP07RU07UTZgDXxA/exec';

const DISTRICT_BOUNDS = { 'hua hin': [[13.1050,99.8800],[13.0900,99.9100],[13.0700,99.9350],[13.0500,99.9500],[12.9800,99.9700],[12.9300,99.9800],[12.8800,99.9850],[12.8500,99.9750],[12.8200,99.9600],[12.7900,99.9400],[12.7600,99.9100],[12.7400,99.8700],[12.7300,99.8300],[12.7200,99.7900],[12.7100,99.7500],[12.7100,99.7000],[12.7200,99.6500],[12.7400,99.6100],[12.7700,99.5700],[12.8100,99.5400],[12.8600,99.5200],[12.9200,99.5100],[12.9800,99.5200],[13.0300,99.5400],[13.0700,99.5700],[13.1000,99.6100],[13.1100,99.6600],[13.1200,99.7100],[13.1200,99.7600],[13.1150,99.8200],[13.1050,99.8800]], 'hua hin district': null, 'pranburi': [[12.7300,99.9400],[12.7100,99.9600],[12.6900,99.9700],[12.6600,99.9650],[12.6300,99.9500],[12.6000,99.9300],[12.5700,99.9000],[12.5400,99.8600],[12.5200,99.8200],[12.5100,99.7700],[12.5000,99.7200],[12.5000,99.6600],[12.5100,99.6000],[12.5300,99.5500],[12.5600,99.5100],[12.6000,99.4800],[12.6500,99.4700],[12.7000,99.4800],[12.7400,99.5000],[12.7700,99.5400],[12.7800,99.5900],[12.7800,99.6400],[12.7700,99.6900],[12.7600,99.7400],[12.7500,99.7900],[12.7400,99.8400],[12.7300,99.8900],[12.7300,99.9400]], 'pranburi district': null, 'cha-am': [[13.5500,99.9700],[13.5200,100.0000],[13.4900,100.0200],[13.4500,100.0100],[13.4100,99.9900],[13.3700,99.9600],[13.3300,99.9300],[13.2900,99.8900],[13.2500,99.8500],[13.2100,99.8100],[13.1800,99.7600],[13.1600,99.7100],[13.1500,99.6500],[13.1500,99.5900],[13.1600,99.5300],[13.1900,99.4800],[13.2300,99.4500],[13.2800,99.4400],[13.3300,99.4500],[13.3800,99.4800],[13.4200,99.5200],[13.4600,99.5700],[13.4900,99.6200],[13.5100,99.6800],[13.5300,99.7400],[13.5500,99.8000],[13.5600,99.8600],[13.5600,99.9200],[13.5500,99.9700]], 'cha am': null, 'cha-am district': null };
const SUBDISTRICT_BOUNDS = { 'hin lek fai sub-district': [[12.6500,99.9000],[12.6400,99.9200],[12.6300,99.9350],[12.6150,99.9450],[12.6000,99.9500],[12.5850,99.9450],[12.5750,99.9350],[12.5700,99.9200],[12.5700,99.9000],[12.5750,99.8800],[12.5900,99.8700],[12.6050,99.8650],[12.6200,99.8700],[12.6350,99.8800],[12.6450,99.8950],[12.6500,99.9000]], 'hua hin sub-district': [[12.5800,99.9600],[12.5700,99.9750],[12.5600,99.9850],[12.5450,99.9900],[12.5300,99.9850],[12.5200,99.9750],[12.5150,99.9600],[12.5150,99.9400],[12.5250,99.9250],[12.5400,99.9150],[12.5550,99.9150],[12.5700,99.9250],[12.5800,99.9400],[12.5800,99.9600]], 'nong kae sub-district': [[12.6100,99.9600],[12.6000,99.9750],[12.5900,99.9850],[12.5750,99.9900],[12.5600,99.9850],[12.5500,99.9700],[12.5500,99.9500],[12.5600,99.9350],[12.5750,99.9250],[12.5900,99.9250],[12.6050,99.9350],[12.6150,99.9500],[12.6100,99.9600]], 'thap tai sub-district': [[12.7200,99.8800],[12.7050,99.9000],[12.6900,99.9150],[12.6700,99.9200],[12.6500,99.9150],[12.6350,99.9050],[12.6250,99.8900],[12.6250,99.8700],[12.6350,99.8550],[12.6550,99.8450],[12.6750,99.8450],[12.6950,99.8550],[12.7100,99.8650],[12.7200,99.8800]], 'nong phlap sub-district': [[12.8000,99.8500],[12.7850,99.8700],[12.7650,99.8850],[12.7450,99.8900],[12.7250,99.8850],[12.7100,99.8700],[12.7050,99.8500],[12.7100,99.8300],[12.7250,99.8150],[12.7450,99.8050],[12.7650,99.8050],[12.7850,99.8150],[12.7980,99.8300],[12.8000,99.8500]], 'na yang sub-district': [[12.8800,99.8200],[12.8650,99.8400],[12.8450,99.8550],[12.8250,99.8600],[12.8050,99.8550],[12.7900,99.8400],[12.7850,99.8200],[12.7900,99.8000],[12.8050,99.7850],[12.8250,99.7750],[12.8450,99.7750],[12.8650,99.7850],[12.8780,99.8000],[12.8800,99.8200]], 'nong ta taem sub-district': [[12.9500,99.7800],[12.9350,99.8000],[12.9150,99.8150],[12.8950,99.8200],[12.8750,99.8150],[12.8600,99.8000],[12.8550,99.7800],[12.8600,99.7600],[12.8750,99.7450],[12.8950,99.7350],[12.9150,99.7350],[12.9350,99.7450],[12.9480,99.7600],[12.9500,99.7800]], 'bueng nakhon sub-district': [[13.0500,99.7200],[13.0350,99.7400],[13.0150,99.7550],[12.9950,99.7600],[12.9750,99.7550],[12.9600,99.7400],[12.9550,99.7200],[12.9600,99.7000],[12.9750,99.6850],[12.9950,99.6750],[13.0150,99.6750],[13.0350,99.6850],[13.0480,99.7000],[13.0500,99.7200]], 'pak nam pran sub-district': [[12.3900,99.9700],[12.3750,99.9900],[12.3600,100.0000],[12.3400,100.0000],[12.3200,99.9950],[12.3050,99.9800],[12.3000,99.9600],[12.3050,99.9400],[12.3200,99.9250],[12.3400,99.9150],[12.3600,99.9150],[12.3780,99.9300],[12.3900,99.9500],[12.3900,99.9700]], 'pranburi sub-district': [[12.4300,99.9300],[12.4150,99.9500],[12.3980,99.9650],[12.3780,99.9700],[12.3580,99.9650],[12.3430,99.9500],[12.3380,99.9300],[12.3430,99.9100],[12.3580,99.8950],[12.3780,99.8850],[12.3980,99.8850],[12.4150,99.8950],[12.4280,99.9100],[12.4300,99.9300]], 'sam roi yot sub-district': [[12.1800,99.9500],[12.1650,99.9700],[12.145,99.9850],[12.125,99.9900],[12.105,99.9850],[12.09,99.9700],[12.085,99.9500],[12.09,99.9300],[12.105,99.9150],[12.125,99.9050],[12.145,99.9050],[12.165,99.9150],[12.178,99.9300],[12.1800,99.9500]], 'khao noi sub-district': [[12.5200,99.8200],[12.5050,99.8400],[12.4850,99.8550],[12.465,99.8600],[12.445,99.8550],[12.43,99.8400],[12.425,99.8200],[12.43,99.8000],[12.445,99.7850],[12.465,99.7750],[12.485,99.7750],[12.505,99.7850],[12.518,99.8000],[12.5200,99.8200]], 'wang phong sub-district': [[12.6000,99.8200],[12.585,99.8400],[12.565,99.8550],[12.545,99.8600],[12.525,99.8550],[12.51,99.8400],[12.505,99.8200],[12.51,99.8000],[12.525,99.7850],[12.545,99.7750],[12.565,99.7750],[12.585,99.7850],[12.598,99.8000],[12.6000,99.8200]], 'cha-am sub-district': [[13.0850,100.0000],[13.0700,100.0150],[13.0500,100.0250],[13.0300,100.0250],[13.0100,100.0200],[12.9950,100.0050],[12.9900,99.9850],[12.9950,99.9650],[13.0100,99.9500],[13.0300,99.9400],[13.0500,99.9400],[13.0700,99.9500],[13.0830,99.9650],[13.0850,99.9850],[13.0850,100.0000]], 'bang kao sub-district': [[13.2000,99.9600],[13.185,99.9800],[13.165,99.9950],[13.145,100.0000],[13.125,99.9950],[13.11,99.9800],[13.105,99.9600],[13.11,99.9400],[13.125,99.9250],[13.145,99.9150],[13.165,99.9150],[13.185,99.9250],[13.198,99.9400],[13.2000,99.9600]], 'huay sat yai sub-district': [[12.8500,99.9200],[12.835,99.9400],[12.815,99.9550],[12.795,99.9600],[12.775,99.9550],[12.76,99.9400],[12.755,99.9200],[12.76,99.9000],[12.775,99.8850],[12.795,99.8750],[12.815,99.8750],[12.835,99.8850],[12.848,99.9000],[12.8500,99.9200]], 'nong sala sub-district': [[13.3200,99.9600],[13.305,99.9800],[13.285,99.9950],[13.265,100.0000],[13.245,99.9950],[13.23,99.9800],[13.225,99.9600],[13.23,99.9400],[13.245,99.9250],[13.265,99.9150],[13.285,99.9150],[13.305,99.9250],[13.318,99.9400],[13.3200,99.9600]], 'yan sue sub-district': [[13.4200,99.9400],[13.405,99.9600],[13.385,99.9750],[13.365,99.9800],[13.345,99.9750],[13.33,99.9600],[13.325,99.9400],[13.33,99.9200],[13.345,99.9050],[13.365,99.8950],[13.385,99.8950],[13.405,99.9050],[13.418,99.9200],[13.4200,99.9400]], 'huay sai tai sub-district': [[12.7600,99.8800],[12.745,99.9000],[12.725,99.9150],[12.705,99.9200],[12.685,99.9150],[12.67,99.9000],[12.665,99.8800],[12.67,99.8600],[12.685,99.8450],[12.705,99.8350],[12.725,99.8350],[12.745,99.8450],[12.758,99.8600],[12.7600,99.8800]], 'khao tao sub-district': [[12.5500,99.9600],[12.535,99.9800],[12.515,99.9950],[12.495,100.0000],[12.475,99.9950],[12.46,99.9800],[12.455,99.9600],[12.46,99.9400],[12.475,99.9250],[12.495,99.9150],[12.515,99.9150],[12.535,99.9250],[12.548,99.9400],[12.5500,99.9600]], 'nong kham sub-district': [[13.1800,99.8600],[13.165,99.8800],[13.145,99.8950],[13.125,99.9000],[13.105,99.8950],[13.09,99.8800],[13.085,99.8600],[13.09,99.8400],[13.105,99.8250],[13.125,99.8150],[13.145,99.8150],[13.165,99.8250],[13.178,99.8400],[13.1800,99.8600]] };

function getBoundary(table, key) { const k = String(key||'').trim().toLowerCase(); let coords = table[k]; if (coords === null) { const base = k.replace(/ sub-district$/,'').replace(/ district$/,'').trim(); for (const [tk, tv] of Object.entries(table)) { if (tv !== null && (tk === base || tk.startsWith(base))) return tv; } return null; } return coords || null; }

const hpId=new URLSearchParams(window.location.search).get('id');
let images=[],idx=0,leafletMap=null;

const LANDMARKS=[ {name:'Hua Hin Beach',lat:12.5696,lon:99.9602}, {name:'Cicada Market',lat:12.5342,lon:99.9655}, {name:'Bluport Hua Hin Mall',lat:12.5518,lon:99.9631}, {name:'Bangkok Hospital',lat:12.5532,lon:99.9610}, {name:'Night Market',lat:12.5714,lon:99.9575}, {name:'Black Mountain Golf',lat:12.6146,lon:99.8924}, {name:'Market Village',lat:12.5598,lon:99.9602}, {name:'Vana Nava',lat:12.5273,lon:99.9642}, {name:'Railway Station',lat:12.5674,lon:99.9548}, {name:'Khao Takiab Beach',lat:12.5186,lon:99.9774}, {name:'Hua Hin Airport',lat:12.6370,lon:99.9515}, {name:'Water Park',lat:12.6046,lon:99.8897} ];

function safeNum(x){return parseFloat(String(x||'').replace(/[^0-9.\-]/g,''))||0;}
function getDistance(lat1,lon1,lat2,lon2){ const R=6371,dLat=(lat2-lat1)*Math.PI/180,dLon=(lon2-lon1)*Math.PI/180; const a=Math.sin(dLat/2)**2+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2; return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*1.35; }
function parseCoordinates(u){ const raw=String(u.Coordinates||'').trim().replace(/[()]/g,'').replace(/\s+/g,''); if(!raw||raw==='#') return null; const [a,b]=raw.split(','); const lat=Number(a),lon=Number(b); return(isFinite(lat)&&isFinite(lon)&&Math.abs(lat)<=90&&Math.abs(lon)<=180)?{lat,lon}:null; }

async function init(){
  if(!hpId) return;
  try{
    const res=await fetch(`${SCRIPT_URL}?mode=getUnitDetail&id=${encodeURIComponent(hpId)}`);
    const json=await res.json();
    if(json.ok){
      if(json.data.System_Status&&json.data.System_Status!=='Online'){
        document.getElementById('gatekeeper').style.display='flex';
        document.getElementById('mainUI').style.display='none';
        hideSplash();return;
      }
      renderData(json.data);hideSplash();
    }else{hideSplash();}
  }catch(e){hideSplash();}
}
function hideSplash(){ const s=document.getElementById('pageSplash'); if(s){s.style.opacity='0';setTimeout(()=>s.style.display='none',400);} }

function renderData(u){
  const p=safeNum(u.Sale_Price||0);
  const a=Math.max(safeNum(u.Living_Area_sq_m||1),1);
  document.getElementById('pID').textContent=u.HP_ID||'-';
  document.getElementById('pPlot').textContent=`Plot ${u.Plot||'-'}`;
  document.getElementById('pLocText').textContent=`üìç ${u.SubDistrict || '-'}, ${u.District || '-'} (${u.Zone || '-'})`;
  document.getElementById('pPrice').textContent=`‡∏ø${Math.round(p).toLocaleString()}`;
  document.getElementById('vBB').textContent=`${u.Bedrooms||0} Bed | ${u.Bathrooms||0} Bath`;
  document.getElementById('vLiving').textContent=`${u.Living_Area_sq_m||'-'} m¬≤`;
  document.getElementById('vLand').textContent=`${u.Land_Area_sq_m||'-'} m¬≤`;
  document.getElementById('vPriceSq').textContent=`‡∏ø${Math.round(p/a).toLocaleString()} / m¬≤`;
  document.getElementById('vFeeM').textContent=`‡∏ø${(safeNum(u.Common_Fee_Rate)||0).toLocaleString()} / m¬≤`;
  document.getElementById('vFeeY').textContent=`‡∏ø${Math.round((safeNum(u.Common_Fee_Rate)||0)*a*12).toLocaleString()} / Yr`;
  document.getElementById('vOwner').textContent=`${u.Ownership_Type || '-'} (${u.Land_Title_Deed_Type || '-'})`;
  document.getElementById('vTransfer').textContent=u.Transfer_Expenses || '-';
  document.getElementById('vStatus').textContent=u.Status || '-';
  document.getElementById('vFurnish').textContent=u.Furnishing || '-';
  document.getElementById('vDistrict').textContent=u.District || '-';
  document.getElementById('vSubDistrict').textContent=u.SubDistrict || '-';
  document.getElementById('vZone').textContent=u.Zone || '-';
  document.getElementById('vPoolSys').textContent=u.Pool_System || '-';
  document.getElementById('vPool').textContent=`${u.Pool_Size || '-'} (${u.Pool_Depth || '-'})`;
  document.getElementById('vKitchen').textContent=u.Kitchen_Type || '-';
  document.getElementById('vParking').textContent=u.Parking || '-';
  document.getElementById('vDirect').textContent=u.Direction || '-';
  document.getElementById('vUtil').textContent=`Elec: ${u.Electricity || '-'} | Water: ${u.Water_Source || '-'}`;
  document.getElementById('vDesc').textContent=u.Description || '-';

  // üéØ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ñ‡∏ö PDF ‡∏°‡∏≤‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå
  if (u.FloorPlan_PDF && u.FloorPlan_PDF !== "#" && u.FloorPlan_PDF.startsWith('http')) {
    const bar = document.getElementById('pdfBarMaster');
    bar.href = u.FloorPlan_PDF;
    bar.style.display = 'flex';
  }

  const c=parseCoordinates(u);
  if(c){
    document.getElementById('mapBox').style.display='block';
    document.getElementById('mapLegend').style.display='flex';
    document.getElementById('nearbyGrid').innerHTML=LANDMARKS.map(loc=>{
      const d=getDistance(c.lat,c.lon,loc.lat,loc.lon);
      return `<div class="nearby-item"><div><div class="loc-name">${loc.name}</div><div class="loc-time">${Math.ceil(d*1.5)} mins drive</div></div><div class="loc-dist">${d.toFixed(1)} km</div></div>`;
    }).join('');
    const distKey = String(u.District||'').trim().toLowerCase();
    const subKey  = String(u.SubDistrict||'').trim().toLowerCase();
    initMap(c.lat, c.lon, distKey, subKey);
  }

  images=u.__album||(u.Album_Image?String(u.Album_Image).split(',').map(x=>x.trim()).filter(Boolean):[]);
  if(!images.length&&u.Thumbnail_Image)images=[u.Thumbnail_Image];
  if(images.length){renderThumbs();setMain(0);}
}

function initMap(lat, lon, distKey, subKey){
  if(leafletMap){leafletMap.remove();leafletMap=null;}
  leafletMap=L.map('leafletMap',{ zoomControl:true,attributionControl:false,scrollWheelZoom:true }).setView([lat,lon],11);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(leafletMap);
  const allBounds=[];
  const distCoords = getBoundary(DISTRICT_BOUNDS, distKey);
  if(distCoords){ L.polyline(distCoords,{color:'#00EE44',weight:3.5,opacity:1,dashArray:'12, 7',interactive:false}).addTo(leafletMap); allBounds.push(...distCoords); }
  const subCoords = getBoundary(SUBDISTRICT_BOUNDS, subKey);
  if(subCoords){ L.polyline(subCoords,{color:'#FFFFFF',weight:9,opacity:0.5,dashArray:'9, 6',interactive:false}).addTo(leafletMap); L.polyline(subCoords,{color:'#FF2222',weight:5,opacity:1,dashArray:'9, 6',interactive:false}).addTo(leafletMap); leafletMap.fitBounds(L.latLngBounds(subCoords),{padding:[25,25]}); return; }
  if(allBounds.length){ leafletMap.fitBounds(L.latLngBounds(allBounds),{padding:[25,25]}); }
}

function setMain(i){
  idx=(i+images.length)%images.length;
  const m=document.getElementById('mainImg');
  m.style.opacity='0';
  setTimeout(()=>{
    m.src=images[idx];m.style.opacity='1';
    document.getElementById('countLabel').textContent=`${idx+1} / ${images.length}`;
    document.querySelectorAll('.thumb').forEach((t,k)=>t.classList.toggle('active',k===idx));
  },150);
}
function changeSlide(n){setMain(idx+n);}
function renderThumbs(){ document.getElementById('thumbStrip').innerHTML=images.map((src,i)=> `<img class="thumb" src="${src}" onclick="setMain(${i})">`).join(''); }
init();
</script>
</body>
</html>
