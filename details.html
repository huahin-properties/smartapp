<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Hua Hin Properties Â· Details</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FULL DETAIL VERSION (RESTORED GALLERY)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root{
  --navy:#0B1829; --navy-mid:#112238; --gold:#C9A84C; --gold-lt:#E4C46A;
  --white:#FDFAF5; --muted:#7A9BB5; --border:rgba(255,255,255,0.08);
  --card-bg:rgba(11,24,41,0.92); --radius:18px;
}

*{box-sizing:border-box; margin:0; padding:0}
body{
  background:var(--navy); color:var(--white); font-family:'Sarabun',sans-serif;
  min-height:100dvh; overflow-x:hidden;
}
body::before {
  content:''; position:fixed; inset:0;
  background: radial-gradient(ellipse 80% 60% at 50% -10%, rgba(27,79,114,0.4) 0%, transparent 60%);
  z-index:0;
}

header {
  position:fixed; top:0; left:0; right:0; z-index:1000; height:60px;
  display:flex; align-items:center; justify-content:space-between;
  padding:0 15px; background:rgba(6,15,26,0.9); backdrop-filter:blur(15px);
  border-bottom:1px solid var(--border);
}
.logo { font-size:1.1rem; font-weight:700; color:var(--gold); text-decoration:none; text-transform:uppercase; letter-spacing:1px; }
.logo span { color:var(--white); font-weight:300; }

.backBtn {
  padding:8px 16px; border-radius:50px; background:rgba(255,255,255,0.05);
  border:1px solid var(--border); color:var(--white); cursor:pointer; font-size:14px;
}

/* FOCUS MODE */
body.mode-focus header { display: none !important; }
body.mode-focus main { padding-top: 20px !important; }

main { position:relative; z-index:1; padding:75px 15px 40px; max-width:1100px; margin:0 auto; }

/* Gallery System */
.gallery-card { background:var(--card-bg); border-radius:var(--radius); border:1px solid var(--border); overflow:hidden; margin-bottom:15px; box-shadow:0 15px 35px rgba(0,0,0,0.5); }
.main-stage { position:relative; width:100%; aspect-ratio:16/10; background:#000; overflow:hidden; }
.main-img { width:100%; height:100%; object-fit:cover; transition:opacity 0.3s; }
.nav-arrow { position:absolute; top:50%; transform:translateY(-50%); width:44px; height:44px; border-radius:50%; background:rgba(0,0,0,0.3); color:white; border:1px solid rgba(255,255,255,0.1); display:flex; align-items:center; justify-content:center; cursor:pointer; z-index:10; }
.nav-left { left:10px; } .nav-right { right:10px; }

.tag-count { position:absolute; right:15px; bottom:15px; background:rgba(0,0,0,0.6); padding:4px 10px; border-radius:50px; font-size:12px; font-weight:600; }
.tag-price { position:absolute; left:15px; bottom:15px; font-size:1.4rem; font-weight:800; color:var(--gold-lt); text-shadow:0 2px 10px rgba(0,0,0,0.8); }

.thumb-row { display:flex; gap:10px; padding:12px; overflow-x:auto; background:rgba(0,0,0,0.2); scrollbar-width:none; }
.thumb-row::-webkit-scrollbar { display:none; }
.thumb { width:90px; aspect-ratio:16/10; border-radius:8px; object-fit:cover; opacity:0.5; cursor:pointer; border:2px solid transparent; flex-shrink:0; }
.thumb.active { opacity:1; border-color:var(--gold); }

/* Content Section */
.info-panel { background:var(--card-bg); border-radius:var(--radius); border:1px solid var(--border); padding:20px; margin-bottom:15px; }
.prop-title { font-size:1.6rem; font-weight:700; margin-bottom:5px; color:var(--white); }
.prop-loc { font-size:0.9rem; color:var(--muted); margin-bottom:20px; display:flex; align-items:center; gap:5px; }

.grid-specs { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:25px; }
.spec-box { background:rgba(255,255,255,0.03); border:1px solid var(--border); border-radius:12px; padding:12px; text-align:center; }
.spec-label { font-size:0.65rem; text-transform:uppercase; color:var(--gold); letter-spacing:1px; margin-bottom:4px; }
.spec-val { font-size:1.1rem; font-weight:700; }

.desc-section { border-top:1px solid var(--border); padding-top:20px; }
.sec-title { font-size:0.75rem; text-transform:uppercase; color:var(--gold); letter-spacing:1.5px; margin-bottom:12px; }
.desc-text { line-height:1.7; color:var(--muted); white-space:pre-wrap; font-size:0.95rem; }

.grid-details { display:grid; grid-template-columns:1fr; gap:12px; margin-top:20px; }
@media(min-width:600px){ .grid-details { grid-template-columns:1fr 1fr; } }
.detail-item { display:flex; justify-content:space-between; padding:10px; background:rgba(0,0,0,0.1); border-radius:8px; font-size:0.85rem; }
.detail-k { color:var(--muted); }

/* LOADER */
.page-loader { position:fixed; inset:0; background:var(--navy); z-index:9999; display:flex; align-items:center; justify-content:center; flex-direction:column; }
.spinner { width:40px; height:40px; border:3px solid rgba(201,168,76,0.2); border-top-color:var(--gold); border-radius:50%; animation:spin 1s linear infinite; }
@keyframes spin { to { transform:rotate(360deg); } }
</style>
</head>

<body>
  <div class="page-loader" id="loader">
    <div class="spinner"></div>
    <div style="margin-top:15px; color:var(--gold); font-size:0.8rem; letter-spacing:1px;">LOADING DETAILS...</div>
  </div>

  <header>
    <a href="index.html" class="logo">Hua Hin<span>.Properties</span></a>
    <button class="backBtn" onclick="goBack()">â† Back</button>
  </header>

  <main>
    <div class="gallery-card">
      <div class="main-stage" id="galleryStage">
        <img id="mainImg" class="main-img" src="" alt="Property">
        <div class="nav-arrow nav-left" onclick="changeSlide(-1)">â®</div>
        <div class="nav-arrow nav-right" onclick="changeSlide(1)">â¯</div>
        <div class="tag-price" id="priceLabel">à¸¿0</div>
        <div class="tag-count" id="countLabel">0 / 0</div>
      </div>
      <div class="thumb-row" id="thumbStrip"></div>
    </div>

    <div class="info-panel">
      <div class="prop-title" id="propTitle">-</div>
      <div class="prop-loc" id="propLoc">ğŸ“ -</div>

      <div class="grid-specs">
        <div class="spec-box"><div class="spec-label">Bedrooms</div><div class="spec-val" id="valBed">-</div></div>
        <div class="spec-box"><div class="spec-label">Bathrooms</div><div class="spec-val" id="valBath">-</div></div>
        <div class="spec-box"><div class="spec-label">Area (sqm)</div><div class="spec-val" id="valArea">-</div></div>
      </div>

      <div class="desc-section">
        <div class="sec-title">Key Selling Points</div>
        <div class="desc-text" id="descContent">-</div>
      </div>

      <div class="grid-details" id="detailGrid"></div>
    </div>
  </main>

<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyOnZc6s05eGvHR5XmRnRPAat8vNZpf8cFhL2GiAFjWld-2OBf2OqgP07RU07UTZgDXxA/exec';
const qs = new URLSearchParams(window.location.search);
const hpId = qs.get("id");
const isFocus = qs.get("mode") === "focus";

let images = [];
let idx = 0;

function goBack() {
  if (history.length > 1) history.back();
  else window.location.href = isFocus ? `index.html?mode=focus` : `index.html`;
}

async function init() {
  if (isFocus) document.body.classList.add('mode-focus');
  if (!hpId) return;

  try {
    const res = await fetch(`${SCRIPT_URL}?mode=getUnitDetail&id=${hpId}`);
    const json = await res.json();
    if (json.ok) render(json.data);
    else alert("Property not found.");
  } catch (e) { console.error(e); }
  
  document.getElementById('loader').style.display = 'none';
}

function render(p) {
  // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸·à¹‰à¸™à¸à¸²à¸™
  document.getElementById('propTitle').textContent = p.Project_Name || p.HP_ID;
  document.getElementById('propLoc').textContent = `ğŸ“ ${p.Zone}, ${p.District}`;
  document.getElementById('priceLabel').textContent = "à¸¿" + (parseFloat(String(p.Sale_Price).replace(/[^0-9.]/g,'')) || 0).toLocaleString();
  
  document.getElementById('valBed').textContent = p.Bedrooms || 0;
  document.getElementById('valBath').textContent = p.Bathrooms || 0;
  document.getElementById('valArea').textContent = p.Living_Area_sq_m || 0;
  
  document.getElementById('descContent').textContent = p.Key_Selling_Points || p.Description || "No description provided.";

  // à¸•à¸²à¸£à¸²à¸‡à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡
  const grid = document.getElementById('detailGrid');
  const details = [
    ["Type", p.Type],
    ["Zone", p.Zone],
    ["Status", p.Status],
    ["Listing Type", p.Listing_Type],
    ["Property ID", p.HP_ID]
  ];
  grid.innerHTML = details.map(([k,v]) => `
    <div class="detail-item">
      <span class="detail-k">${k}</span>
      <span class="detail-v">${v || '-'}</span>
    </div>
  `).join('');

  // à¸£à¸°à¸šà¸š Gallery
  images = p.__album || [];
  if (images.length === 0 && p.__thumb) images = [p.__thumb];
  if (images.length > 0) {
    renderThumbs();
    setMain(0);
  }
}

function setMain(i) {
  idx = (i + images.length) % images.length;
  document.getElementById('mainImg').src = images[idx];
  document.getElementById('countLabel').textContent = `${idx + 1} / ${images.length}`;
  
  document.querySelectorAll('.thumb').forEach((t, k) => {
    t.classList.toggle('active', k === idx);
  });
}

function changeSlide(n) { setMain(idx + n); }

function renderThumbs() {
  const row = document.getElementById('thumbStrip');
  row.innerHTML = images.map((src, i) => `
    <img class="thumb" src="${src}" onclick="setMain(${i})">
  `).join('');
}

// Swipe Support
let startX = 0;
document.getElementById('galleryStage').addEventListener('touchstart', e => startX = e.touches[0].clientX);
document.getElementById('galleryStage').addEventListener('touchend', e => {
  const endX = e.changedTouches[0].clientX;
  if (startX - endX > 50) changeSlide(1);
  if (endX - startX > 50) changeSlide(-1);
});

init();
</script>
</body>
</html>
