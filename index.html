<script>
  // ... (ส่วน init() และ renderSpecialContent เหมือนเดิม) ...

  async function getProperties(params) {
    try {
      const response = await fetch(`${SCRIPT_URL}?mode=getUnitList&${params.toString()}`);
      const json = await response.json();
      renderList(json.data);
    } catch (err) { console.error(err); }
  }

  function renderList(items) {
    const grid = document.getElementById('propGrid');
    document.getElementById('unitCount').textContent = `${items.length} UNITS`;

    grid.innerHTML = items.map(p => {
      // ตรวจสอบคอลัมน์รูปภาพ Thumbnail_Image
      const thumb = p.Thumbnail_Image && p.Thumbnail_Image.startsWith('http') 
                    ? p.Thumbnail_Image 
                    : (p.Thumbnail_Image ? `https://lh3.googleusercontent.com/d/${p.Thumbnail_Image}` : '');

      const pPrice = parseFloat(String(p.Sale_Price).replace(/[^0-9.]/g, '')) || 0;
      
      return `
        <a href="details.html?id=${p.HP_ID}${urlParams.has('s')?'&mode=focus':''}" class="card">
          <div class="card-img">
            <span class="hp-id">#${p.HP_ID}</span>
            <img src="${thumb}" loading="lazy" onerror="this.src='https://placehold.co/400x300/112238/CEA86C?text=Property'">
          </div>
          <div class="card-info">
            <div class="info-main">
              <div class="prop-name">${p.Project_Name}</div>
              <div style="font-size:0.7rem;color:var(--muted);">${p.Bedrooms} Bed | ${p.Zone}</div>
            </div>
            <div class="price">฿${pPrice.toLocaleString()}</div>
          </div>
        </a>`;
    }).join('');
  }
  // ... (ส่วน Filter เดิม) ...
</script>
