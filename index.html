<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no"/>
  <title>Hua Hin Properties | Luxury Asset Catalog</title>

  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@200;300;400;500;600&family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>

  <style>
    :root {
      --navy: #0B1829; --navy-dark: #060F1A; --gold: #C9A84C; --gold-lt: #E4C46A;
      --white: #FDFAF5; --muted: #7A9BB5; --border: rgba(255, 255, 255, 0.08);
      --card-bg: rgba(11, 24, 41, 0.9); --brand-red: #8B1F2D;
      --available: #2ECC8A; --reserved: #E8A020; --sold: #E05555;
      --rented: #5B9BD5; --row-h: 75px; --thumb-w: 110px;
    }

    body.is-line { zoom: 0.88; -moz-transform: scale(0.88); -moz-transform-origin: 0 0; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background-color: var(--navy-dark); color: var(--white); font-family: 'Montserrat', 'Sarabun', sans-serif; overflow-x: hidden; -webkit-font-smoothing: antialiased; }
    body::before { content: ''; position: fixed; inset: 0; background: radial-gradient(circle at 50% -10%, rgba(27, 79, 114, 0.3) 0%, transparent 70%); z-index: -1; }

    header { position: fixed; top: 0; width: 100%; height: 55px; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; background: rgba(6, 15, 26, 0.95); backdrop-filter: blur(15px); z-index: 1000; border-bottom: 1px solid var(--border); }
    .logo { font-size: 1.15rem; font-weight: 700; color: var(--gold); text-decoration: none; letter-spacing: 0.02em; }
    .logo span { color: var(--white); font-weight: 300; }
    .btn-contact { background: var(--gold); color: var(--navy-dark); padding: 6px 14px; border-radius: 4px; font-size: 0.65rem; font-weight: 800; text-decoration: none; text-transform: uppercase; }

    .hero { padding: 75px 15px 10px; text-align: center; }
    .hero-title-wrap { display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 12px; }
    .hero-title { font-size: 1.8rem; font-weight: 300; margin: 0; }
    .hero-title em { font-style: normal; color: var(--gold-lt); }
    .btn-reset { background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: var(--gold); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.1rem; }

    .search-container { max-width: 550px; margin: 0 auto; }
    .search-box { position: relative; margin-bottom: 10px; }
    .search-input { width: 100%; background: rgba(255, 255, 255, 0.06); border: 1px solid var(--border); border-radius: 50px; padding: 10px 15px 10px 40px; color: var(--white); font-size: 0.85rem; outline: none; }
    .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--gold); font-size: 0.8rem; }
    .filters-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; margin-bottom: 10px; }
    .filter-select { background: rgba(255, 255, 255, 0.08); border: 1px solid var(--border); border-radius: 8px; padding: 8px; color: var(--white); font-size: 0.75rem; appearance: none; outline: none; }
    .pill-container { display: flex; gap: 6px; overflow-x: auto; padding-bottom: 8px; scrollbar-width: none; }
    .pill { white-space: nowrap; padding: 6px 14px; border-radius: 50px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); color: var(--muted); font-size: 0.65rem; font-weight: 700; cursor: pointer; text-transform: uppercase; }
    .pill.active { background: var(--gold); color: var(--navy-dark); border-color: var(--gold); }

    .section-bar { display: flex; justify-content: space-between; align-items: baseline; padding: 15px 15px 10px; border-top: 1px solid var(--border); margin-top: 10px; }
    .section-title { font-size: 1.15rem; font-weight: 300; }
    .unit-count { font-size: 0.65rem; color: var(--muted); font-weight: 700; letter-spacing: 1px; }

    /* SPECIAL MESSAGE BOX */
    .special-msg-box {
      display: none;
      background: rgba(201, 168, 76, 0.08);
      border: 1px dashed var(--gold);
      border-radius: 12px;
      padding: 15px;
      margin: 10px 15px 20px;
      text-align: center;
      color: var(--gold-lt);
      font-size: 0.95rem;
      font-weight: 400;
      justify-content: center;
      align-items: center;
      gap: 10px;
      animation: fadeIn 0.8s ease;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

    .prop-list { padding: 0 12px 40px; display: grid; grid-template-columns: 1fr; gap: 6px; }
    .card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; display: flex; overflow: hidden; text-decoration: none; color: inherit; height: var(--row-h); transition: 0.2s ease; }
    .card:active { transform: scale(0.98); border-color: var(--gold); }
    .card-img { width: var(--thumb-w); flex-shrink: 0; position: relative; background: #000; }
    .card-img img { width: 100%; height: 100%; object-fit: cover; }
    .hp-id { position: absolute; top: 5px; left: 7px; font-size: 0.48rem; color: rgba(255, 255, 255, 0.6); z-index: 2; }
    .card-info { flex: 1; padding: 6px 10px; display: grid; grid-template-columns: 1fr auto; align-items: center; min-width: 0; gap: 5px; }
    .prop-name { font-size: 0.88rem; font-weight: 700; color: var(--white); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .prop-specs { font-size: 0.7rem; color: var(--muted); margin: 1px 0; }
    .prop-zone { font-size: 0.65rem; color: var(--muted); opacity: 0.6; }
    .price { font-size: 1rem; font-weight: 800; color: var(--gold-lt); }
    .tag { font-size: 0.45rem; font-weight: 800; padding: 2px 6px; border-radius: 3px; text-transform: uppercase; }
    .tag-status { background: rgba(255,255,255,0.08); border: 0.5px solid rgba(255,255,255,0.15); }
    .tag-badge { background: var(--brand-red); color: white; }

    .skel { height: var(--row-h); background: rgba(255,255,255,0.03); border-radius: 12px; animation: pulse 1.5s infinite; }
    @keyframes pulse { 50% { opacity: 0.5; } }

    /* FOCUS MODE STYLES */
    body.mode-focus header, body.mode-focus .hero, body.mode-focus .search-container { display: none !important; }
    body.mode-focus main { padding-top: 20px !important; }
    body.mode-focus .section-bar { border-top: none; justify-content: center; }

    @media (min-width: 768px) {
      :root { --row-h: 90px; --thumb-w: 140px; }
      .prop-list { grid-template-columns: repeat(2, 1fr); gap: 12px; }
      .hero-title { font-size: 2.5rem; }
    }
  </style>
</head>
<body>

  <header id="mainHeader">
    <a href="#" class="logo">HUA HIN<span>.PROPERTIES</span></a>
    <a href="https://line.me/R/ti/p/@qap7218t" class="btn-contact">Contact</a>
  </header>

  <section class="hero" id="heroSection">
    <div class="hero-title-wrap">
      <h1 class="hero-title">Prime <em>Asset</em> Catalog</h1>
      <button class="btn-reset" onclick="resetFilters()" title="Reset Filters">‚Üª</button>
    </div>
    
    <div class="search-container">
      <div class="search-box">
        <span class="search-icon">üîç</span>
        <input type="text" id="searchInput" class="search-input" placeholder="Search Location, ID, or Project...">
      </div>
      <div class="filters-grid">
        <select id="areaFilter" class="filter-select">
          <option value="">All Zones</option>
          <option value="Hua Hin">Hua Hin</option>
          <option value="Cha-am">Cha-am</option>
          <option value="Pranburi">Pranburi</option>
        </select>
        <select id="sortFilter" class="filter-select">
          <option value="">All Prices</option>
          <option value="low-high">Low ‚Üí High</option>
          <option value="high-low">High ‚Üí Low</option>
        </select>
        <select id="bedFilter" class="filter-select">
          <option value="">Bedrooms</option>
          <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select>
      </div>
      <div class="pill-container" id="pillBox">
        <div class="pill active" data-f="all">All</div>
        <div class="pill" data-f="Sale">Sale</div>
        <div class="pill" data-f="Rent">Rent</div>
        <div class="pill" data-f="Pool Villa">Pool Villa</div>
        <div class="pill" data-f="Condo">Condo</div>
      </div>
    </div>
  </section>

  <div id="specialMsgBox" class="special-msg-box">
    <span style="font-size: 1.2rem;">‚ú®</span>
    <span id="specialMsgText"></span>
  </div>

  <div class="section-bar">
    <h2 class="section-title" id="barTitle">Luxury Collections</h2>
    <span class="unit-count" id="unitCount">Loading...</span>
  </div>

  <section class="prop-list" id="propGrid">
    <div class="skel"></div><div class="skel"></div><div class="skel"></div><div class="skel"></div>
  </section>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyOnZc6s05eGvHR5XmRnRPAat8vNZpf8cFhL2GiAFjWld-2OBf2OqgP07RU07UTZgDXxA/exec';
    let rawData = [];
    
    const urlParams = new URLSearchParams(window.location.search);
    const isFocusMode = urlParams.get('mode') === 'focus';
    const specialMsg = urlParams.get('msg');
    
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Focus Mode ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©
    if (isFocusMode) {
      document.body.classList.add('mode-focus');
      document.getElementById('barTitle').textContent = "Selected Properties";
      
      if (specialMsg) {
        const msgBox = document.getElementById('specialMsgBox');
        document.getElementById('specialMsgText').textContent = specialMsg;
        msgBox.style.display = 'flex';
      }
    }

    function checkLineBrowser() {
      const ua = navigator.userAgent || navigator.vendor || window.opera;
      if (ua.indexOf("Line") > -1) document.body.classList.add('is-line');
    }

    async function getProperties() {
      try {
        const fetchUrl = SCRIPT_URL + '?mode=getUnitList&' + urlParams.toString();
        const response = await fetch(fetchUrl);
        const json = await response.json();
        rawData = json.data;
        renderList(rawData);
      } catch (err) { console.error(err); }
    }

    function renderList(items) {
      const grid = document.getElementById('propGrid');
      document.getElementById('unitCount').textContent = `${items.length} UNITS`;
      if(items.length === 0) {
        grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--muted);">No results found matching your criteria.</div>';
        return;
      }
      grid.innerHTML = items.map(p => {
        const pNum = parseFloat(String(p.Sale_Price || "0").replace(/[^0-9.]/g, '')) || 0;
        const dPrice = pNum === 0 ? "‚Äî" : "‡∏ø" + pNum.toLocaleString();
        const detailLink = `details.html?id=${p.HP_ID}${isFocusMode ? '&mode=focus' : ''}`;

        return `
          <a href="${detailLink}" class="card">
            <div class="card-img">
              <span class="hp-id">#${p.HP_ID}</span>
              <img src="${p.Thumbnail_Image}" alt="property" loading="lazy">
            </div>
            <div class="card-info">
              <div class="info-main">
                <div class="prop-name">${p.Project_Name || p.Listing_Type}</div>
                <div class="prop-specs">${p.Bedrooms} Bed | ${p.Bathrooms} Bath | ${p.Living_Area_sq_m} sqm</div>
                <div class="prop-zone">${p.Zone}</div>
              </div>
              <div class="price-side">
                <div class="price">${dPrice}</div>
                <div style="display:flex; flex-direction:column; gap:3px; align-items:flex-end;">
                  <span class="tag tag-status">${p.Status}</span>
                  ${p.Badge ? `<span class="tag tag-badge">${p.Badge}</span>` : ''}
                </div>
              </div>
            </div>
          </a>`;
      }).join('');
    }

    function filterData() {
      const q = document.getElementById('searchInput').value.trim().toLowerCase();
      const area = document.getElementById('areaFilter').value;
      const bed = document.getElementById('bedFilter').value;
      const sort = document.getElementById('sortFilter').value;
      const activePill = document.querySelector('.pill.active').dataset.f;

      let filtered = rawData.filter(p => {
        const text = `${p.District} ${p.HP_ID} ${p.Project_Name} ${p.Zone}`.toLowerCase();
        const matchQ = q === "" || text.includes(q);
        const matchArea = area === "" || p.District === area || p.Zone === area;
        let matchBed = bed === "" || parseInt(p.Bedrooms) == parseInt(bed);
        const matchPill = activePill === "all" || p.Listing_Type === activePill || p.Type === activePill || p.Status === activePill;
        return matchQ && matchArea && matchBed && matchPill;
      });

      if (sort === "low-high") filtered.sort((a, b) => {
        const pA = parseFloat(String(a.Sale_Price || "0").replace(/[^0-9.]/g, ''));
        const pB = parseFloat(String(b.Sale_Price || "0").replace(/[^0-9.]/g, ''));
        return pA - pB;
      });
      else if (sort === "high-low") filtered.sort((a, b) => {
        const pA = parseFloat(String(a.Sale_Price || "0").replace(/[^0-9.]/g, ''));
        const pB = parseFloat(String(b.Sale_Price || "0").replace(/[^0-9.]/g, ''));
        return pB - pA;
      });

      renderList(filtered);
    }

    function resetFilters() { location.href = location.pathname; }

    document.getElementById('searchInput').addEventListener('input', filterData);
    document.getElementById('areaFilter').addEventListener('change', filterData);
    document.getElementById('bedFilter').addEventListener('change', filterData);
    document.getElementById('sortFilter').addEventListener('change', filterData);
    document.getElementById('pillBox').addEventListener('click', (e) => {
      if (e.target.classList.contains('pill')) {
        document.querySelectorAll('.pill').forEach(el => el.classList.remove('active'));
        e.target.classList.add('active');
        filterData();
      }
    });

    checkLineBrowser();
    getProperties();
  </script>
</body>
</html>
