<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"/>
  <title>Master Dashboard V111 | HuaHin.Properties</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Montserrat', sans-serif; background: #f8fafc; padding-bottom: 50px; }
    .unit-card { background: white; border-radius: 1.25rem; overflow: hidden; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid #e2e8f0; }
    .unit-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
    .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.6rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; }
    .btn-edit { background: #0f172a; color: white; padding: 10px; border-radius: 0.75rem; font-size: 0.7rem; font-weight: 700; text-align: center; width: 100%; display: block; }
    .search-input { width: 100%; padding: 1rem 1.5rem; border-radius: 1.5rem; border: 1px solid #e2e8f0; font-weight: 600; outline: none; transition: border 0.2s; }
    .search-input:focus { border-color: #0f172a; box-shadow: 0 0 0 4px rgba(15,23,42,0.05); }
    .filter-btn { padding: 8px 16px; border-radius: 12px; font-size: 0.75rem; font-weight: 700; background: white; border: 1px solid #e2e8f0; color: #64748b; }
    .filter-btn.active { background: #0f172a; color: white; border-color: #0f172a; }
  </style>
</head>
<body>
  <div class="max-w-6xl mx-auto p-4 md:p-8">
    <header class="mb-10">
      <div class="flex flex-col md:flex-row md:items-end justify-between gap-6">
        <div>
          <h1 class="text-3xl font-800 text-slate-900 tracking-tight">MASTER DASHBOARD</h1>
          <p class="text-slate-400 text-xs mt-2 font-600 uppercase tracking-widest">Property Management Console V111</p>
        </div>
        <div class="flex gap-2" id="filterContainer">
          <button class="filter-btn active" onclick="filterData('all', this)">ALL PROJECTS</button>
          <button class="filter-btn" onclick="filterData('coco', this)">COCO</button>
          <button class="filter-btn" onclick="filterData('pyne', this)">PYNE PLUS</button>
        </div>
      </div>
      <div class="mt-8">
        <input type="text" id="searchInput" class="search-input" placeholder="Search by HP ID, Plot, or Project Name..." onkeyup="searchUnits()">
      </div>
    </header>

    <div id="loading" class="text-center py-20"><div class="animate-spin inline-block w-8 h-8 border-4 border-slate-900 border-t-transparent rounded-full mb-4"></div><p class="text-slate-400 font-600 text-sm">FETCHING PROPERTIES...</p></div>
    
    <div id="unitGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 opacity-0 transition-opacity duration-500">
      </div>
  </div>

  <script>
    const API = "https://script.google.com/macros/s/AKfycbyOnZc6s05eGvHR5XmRnRPAat8vNZpf8cFhL2GiAFjWld-2OBf2OqgP07RU07UTZgDXxA/exec"; //
    let allUnits = [];
    let currentFilter = 'all';

    async function fetchUnits() {
      try {
        const res = await fetch(`${API}?mode=getListSmall`);
        allUnits = await res.json();
        renderUnits(allUnits);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('unitGrid').classList.remove('opacity-0');
      } catch (e) { alert("Failed to fetch data. Check your API and Deployment."); }
    }

    function renderUnits(units) {
      const grid = document.getElementById('unitGrid');
      grid.innerHTML = units.map(u => {
        // กำหนดสีตามโครงการ
        const isCoco = String(u.Project_Name).toLowerCase().includes('coco');
        const projectColor = isCoco ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700';
        const repoName = isCoco ? 'smartapp-coco' : 'smartapp-pyneplus';
        
        return `
          <div class="unit-card flex flex-col">
            <div class="relative h-40 bg-slate-200">
              <img src="${u.Thumbnail_Image || 'https://via.placeholder.com/400x300'}" class="w-full h-full object-cover">
              <div class="absolute top-3 left-3 flex flex-col gap-1">
                <span class="badge ${u.Status === 'Available' ? 'bg-emerald-500 text-white' : 'bg-rose-500 text-white'}">${u.Status}</span>
                <span class="badge ${projectColor}">${u.Project_Name}</span>
              </div>
            </div>
            <div class="p-5 flex-1 flex flex-col">
              <div class="flex justify-between items-start mb-2">
                <h3 class="font-800 text-slate-800 text-lg">PLOT: ${u.Plot || 'N/A'}</h3>
                <span class="text-[10px] font-700 text-slate-400 bg-slate-100 px-2 py-1 rounded-md">${u.HP_ID}</span>
              </div>
              <p class="text-[10px] font-600 text-slate-400 mb-4 uppercase">${u.Bedrooms} Bedrooms • ${u.Living_Area_sq_m} SQ.M</p>
              <div class="mt-auto">
                <a href="https://huahin-properties.github.io/${repoName}/admin.html?id=${u.HP_ID}" class="btn-edit uppercase tracking-widest hover:bg-slate-800">Edit Asset</a>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function searchUnits() {
      const term = document.getElementById('searchInput').value.toLowerCase();
      const filtered = allUnits.filter(u => 
        u.HP_ID.toLowerCase().includes(term) || 
        (u.Plot && u.Plot.toLowerCase().includes(term)) ||
        u.Project_Name.toLowerCase().includes(term)
      );
      renderUnits(filtered);
    }

    function filterData(proj, btn) {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentFilter = proj;
      
      if(proj === 'all') {
        renderUnits(allUnits);
      } else {
        const filtered = allUnits.filter(u => String(u.Project_Name).toLowerCase().includes(proj));
        renderUnits(filtered);
      }
    }

    window.onload = fetchUnits;
  </script>
</body>
</html>
