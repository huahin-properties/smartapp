<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>Master Dashboard | Live Color Control V157</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body { font-family: 'Montserrat', sans-serif; background: #060F1A; color: white; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; }
    .content-wrapper { padding: 15px; max-width: 1200px; margin: 0 auto; }
    
    /* üéØ Header Bar */
    .header-bar { display: grid; grid-template-columns: 70px 120px 1.5fr 1fr 150px 50px; gap: 12px; padding: 18px 25px; background: rgba(201, 168, 76, 0.1); border-radius: 15px; margin-bottom: 15px; border: 1px solid rgba(201, 168, 76, 0.2); }
    .header-label { font-size: 10px; font-weight: 800; color: #C9A84C; text-transform: uppercase; letter-spacing: 1.5px; }
    
    /* üéØ Unit Row Design */
    .unit-row { display: grid; grid-template-columns: 70px 120px 1.5fr 1fr 150px 50px; gap: 12px; align-items: center; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); border-radius: 1.5rem; padding: 12px 25px; margin-bottom: 10px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .unit-row:hover { background: rgba(255,255,255,0.08); border-color: rgba(201, 168, 76, 0.4); transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
    
    /* üéØ HP-ID Enhancement */
    .u-id-txt { font-size: 13px; font-weight: 800; color: #FFFFFF; letter-spacing: -0.5px; text-shadow: 0 0 10px rgba(255,255,255,0.1); }

    /* üéØ System Status Dynamic Colors */
    .status-select { background: #0B1829; border: 2px solid rgba(255,255,255,0.08); border-radius: 10px; font-size: 11px; font-weight: 800; padding: 8px 12px; outline: none; width: 100%; cursor: pointer; transition: 0.3s; }
    
    /* Online: Green */
    .st-online { color: #10B981 !important; border-color: rgba(16, 185, 129, 0.5) !important; background: rgba(16, 185, 129, 0.05); }
    /* Pending: Orange */
    .st-pending { color: #F59E0B !important; border-color: rgba(245, 158, 11, 0.5) !important; background: rgba(245, 158, 11, 0.05); }
    /* Offline: Dark/Gray */
    .st-offline { color: #64748B !important; border-color: rgba(100, 116, 139, 0.5) !important; background: rgba(100, 116, 139, 0.05); }
    
    select option { background: #0B1829; color: white; padding: 12px; }
    .opt-online { color: #10B981; font-weight: 700; } 
    .opt-pending { color: #F59E0B; font-weight: 700; } 
    .opt-offline { color: #94A3B8; font-weight: 700; }

    .loading-overlay { position: fixed; inset: 0; background: rgba(6,15,26,0.92); z-index: 10000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
    .loader { border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid #C9A84C; border-radius: 50%; width: 35px; height: 35px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* üì± Mobile Responsive Mastery */
    @media (max-width: 900px) {
      .header-bar { display: none; }
      .unit-row { grid-template-columns: 70px 1fr 1fr; grid-template-rows: auto auto auto; padding: 20px; gap: 12px; }
      .u-img { grid-row: span 2; align-self: start; }
      .u-id { grid-column: span 1; display: flex; align-items: center; }
      .u-edit { grid-column: span 1; text-align: right; }
      .u-project { grid-column: span 2; font-size: 14px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 8px; }
      .u-sale { grid-column: span 1; display: flex; align-items: center; }
      .u-control { grid-column: span 2; }
    }
  </style>
</head>
<body>
  <div id="quickLoad" class="loading-overlay"><div class="flex flex-col items-center gap-5"><div class="loader"></div><div class="text-xs font-800 tracking-[0.4em] text-[#C9A84C] uppercase italic">Syncing Database...</div></div></div>

  <div class="content-wrapper">
    <div class="flex justify-between items-center mb-8 mt-2 px-2">
      <div><h1 class="text-3xl font-800 uppercase text-[#C9A84C] italic tracking-tighter leading-none">Database Hub</h1><p class="text-[9px] font-700 text-slate-500 uppercase tracking-widest mt-2">Central Master Control V157</p></div>
      <button onclick="location.href='add.html'" class="bg-[#C9A84C] text-[#060F1A] px-6 py-3 rounded-2xl font-800 text-[11px] uppercase shadow-[0_10px_30px_rgba(201,168,76,0.3)] transition-all hover:scale-105 active:scale-95"><i class="fas fa-plus mr-2"></i>Add Asset</button>
    </div>
    
    <input type="text" id="sI" onkeyup="filter()" placeholder="Search Plot Name, Unit ID or Project..." class="w-full bg-white/5 border border-white/10 rounded-[1.2rem] px-7 py-5 mb-8 outline-none focus:border-[#C9A84C] focus:bg-white/10 text-sm font-600 transition-all shadow-inner">
    
    <div class="header-bar">
      <div class="header-label text-center">Unit</div>
      <div class="header-label">HP-ID</div>
      <div class="header-label">Project Name</div>
      <div class="header-label">Inventory</div>
      <div class="header-label text-center">System Live</div>
      <div class="header-label text-right">Action</div>
    </div>

    <div id="list">
      <div class="text-center py-32 text-slate-700 font-800 text-xs animate-pulse tracking-[0.5em] uppercase">Connecting to Cloud Server...</div>
    </div>
  </div>

  <script>
    const API = "https://script.google.com/macros/s/AKfycbyOnZc6s05eGvHR5XmRnRPAat8vNZpf8cFhL2GiAFjWld-2OBf2OqgP07RU07UTZgDXxA/exec";
    let data = [];

    async function init() {
      const res = await fetch(`${API}?mode=getListSmall&project=all`);
      data = await res.json(); 
      render(data);
    }

    function render(items) {
      document.getElementById('list').innerHTML = items.map(u => {
        const sysStatus = u.System_Status || 'Pending';
        // üéØ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏£‡∏¥‡∏á
        const colorClass = sysStatus === 'Online' ? 'st-online' : (sysStatus === 'Offline' ? 'st-offline' : 'st-pending');
        const icon = sysStatus === 'Online' ? '‚óè' : (sysStatus === 'Offline' ? '‚óã' : 'üïí');
        
        return `
          <div class="unit-row">
            <div class="flex justify-center u-img">
              <img src="${u.Thumbnail_Image || 'https://via.placeholder.com/150x100?text=HP'}" class="w-14 h-11 rounded-xl object-cover bg-black border border-white/10 shadow-xl">
            </div>

            <div class="u-id">
              <span class="u-id-txt">#${u.HP_ID}</span>
            </div>
            
            <div class="font-700 text-[14px] truncate uppercase tracking-tight text-slate-200 u-project">${u.Project_Name || 'Master'}</div>
            
            <div class="u-sale">
              <span class="text-[10px] font-800 text-[#C9A84C] bg-[#C9A84C]/10 px-3 py-1.5 rounded-lg border border-[#C9A84C]/20 uppercase">${u.Status || 'Available'}</span>
            </div>
            
            <div class="u-control">
              <select onchange="quickUpdateStatus('${u.HP_ID}', this)" class="status-select ${colorClass}">
                <option value="Online" ${sysStatus === 'Online' ? 'selected' : ''} class="opt-online">‚óè ONLINE</option>
                <option value="Offline" ${sysStatus === 'Offline' ? 'selected' : ''} class="opt-offline">‚óè OFFLINE</option>
                <option value="Pending" ${sysStatus === 'Pending' ? 'selected' : ''} class="opt-pending">‚óè PENDING</option>
              </select>
            </div>

            <div class="text-right u-edit">
              <button onclick="location.href='edit.html?id=${u.HP_ID}'" class="w-10 h-10 rounded-2xl bg-white/5 hover:bg-[#C9A84C] hover:text-[#060F1A] flex items-center justify-center transition-all border border-white/5 shadow-inner">
                <i class="fas fa-edit text-[12px]"></i>
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    async function quickUpdateStatus(id, selectEl) {
      const newStatus = selectEl.value;
      showLoading(true);
      
      try {
        const res = await fetch(API, {
          method: 'POST',
          body: JSON.stringify({ mode: "updateUnit", HP_ID: id, System_Status: newStatus })
        });
        const result = await res.json();
        if(result.ok) {
          // üéØ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
          selectEl.className = `status-select ${newStatus === 'Online' ? 'st-online' : (newStatus === 'Offline' ? 'st-offline' : 'st-pending')}`;
          const index = data.findIndex(item => item.HP_ID === id);
          if(index !== -1) data[index].System_Status = newStatus;
        } else { alert("Sync Error!"); }
      } catch(e) { alert("Network Error: " + e); }
      finally { showLoading(false); }
    }

    function filter() {
      const q = document.getElementById('sI').value.toLowerCase();
      render(data.filter(u => 
        u.HP_ID.toLowerCase().includes(q) || 
        (u.Project_Name && u.Project_Name.toLowerCase().includes(q)) ||
        (u.Plot && u.Plot.toLowerCase().includes(q))
      ));
    }

    function showLoading(show) { document.getElementById('quickLoad').style.display = show ? 'flex' : 'none'; }
    window.onload = init;
  </script>
</body>
</html>
