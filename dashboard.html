<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>Master Dashboard | V160 Online Only</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body { font-family: 'Montserrat', sans-serif; background: #060F1A; color: white; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; }
    .content-wrapper { padding: 10px; max-width: 1000px; margin: 0 auto; }
    .unit-card { background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.05); border-radius: 14px; padding: 10px 12px; margin-bottom: 6px; display: flex; flex-direction: column; gap: 6px; }
    .row-1 { display: flex; align-items: center; gap: 10px; position: relative; }
    .u-img { width: 50px; height: 38px; border-radius: 6px; object-fit: cover; background: #000; border: 1px solid rgba(255,255,255,0.1); }
    .u-info-main { flex: 1; min-width: 0; display: flex; align-items: center; gap: 8px; }
    
    /* üéØ HP-ID ‡πÄ‡∏î‡πà‡∏ô‡∏ä‡∏±‡∏î ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ # */
    .u-id-badge { font-size: 12px; font-weight: 800; color: #FFFFFF; background: rgba(201, 168, 76, 0.2); padding: 2px 8px; border-radius: 4px; white-space: nowrap; border: 1px solid rgba(201, 168, 76, 0.3); }
    
    .u-project-name { font-size: 11px; font-weight: 600; color: #94A3B8; text-transform: uppercase; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .row-2 { display: flex; align-items: center; gap: 10px; }
    .u-sale-status { font-size: 9px; font-weight: 800; color: #C9A84C; background: rgba(201, 168, 76, 0.08); padding: 5px 10px; border-radius: 6px; border: 1px solid rgba(201, 168, 76, 0.15); min-width: 90px; text-align: center; text-transform: uppercase; }
    
    /* üéØ ‡∏™‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î */
    .status-select { flex: 1; background: #0B1829; border-radius: 8px; font-size: 10px; font-weight: 800; padding: 5px 8px; outline: none; cursor: pointer; border: 1.5px solid transparent; }
    .st-online { color: #10B981 !important; border-color: rgba(16, 185, 129, 0.4) !important; background: rgba(16, 185, 129, 0.03); }
    
    .btn-edit-mini { width: 32px; height: 32px; border-radius: 8px; background: rgba(255,255,255,0.03); display: flex; align-items: center; justify-content: center; color: #64748B; border: 1px solid rgba(255,255,255,0.05); }
    .loading-overlay { position: fixed; inset: 0; background: rgba(6,15,26,0.9); z-index: 10000; display: none; align-items: center; justify-content: center; }
    .loader { border: 2px solid rgba(255,255,255,0.1); border-top: 2px solid #C9A84C; border-radius: 50%; width: 24px; height: 24px; animation: spin 0.8s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div id="quickLoad" class="loading-overlay"><div class="loader"></div></div>
  <div class="content-wrapper">
    <div class="flex justify-between items-center mb-4 mt-1 px-1">
      <h1 class="text-xl font-800 uppercase text-[#C9A84C] italic tracking-tighter">Live Dashboard</h1>
      <button onclick="location.href='add.html'" class="bg-[#C9A84C] text-[#060F1A] px-4 py-1.5 rounded-lg font-800 text-[10px] uppercase shadow-lg">Add Unit</button>
    </div>
    <input type="text" id="sI" onkeyup="filter()" placeholder="Quick Search ID..." class="w-full bg-white/5 border border-white/10 rounded-xl px-5 py-3 mb-4 outline-none focus:border-[#C9A84C] text-sm font-600 transition-all shadow-inner">
    <div id="list"></div>
  </div>

  <script>
    const API = "https://script.google.com/macros/s/AKfycbyOnZc6s05eGvHR5XmRnRPAat8vNZpf8cFhL2GiAFjWld-2OBf2OqgP07RU07UTZgDXxA/exec";
    let data = [];
    async function init() {
      const res = await fetch(`${API}?mode=getListSmall&project=all`);
      data = await res.json(); render();
    }
    function render() {
      const q = document.getElementById('sI').value.toLowerCase();
      // üéØ ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 2: ‡∏•‡πá‡∏≠‡∏Ñ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ONLINE ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Dashboard
      const filtered = data.filter(u => 
        u.System_Status === 'Online' && 
        (!q || u.HP_ID.toLowerCase().includes(q) || (u.Project_Name && u.Project_Name.toLowerCase().includes(q)))
      );
      
      document.getElementById('list').innerHTML = filtered.map(u => `
        <div class="unit-card">
          <div class="row-1">
            <img src="${u.Thumbnail_Image || 'https://via.placeholder.com/60x45?text=NA'}" class="u-img shadow-md">
            <div class="u-info-main">
              <span class="u-id-badge">${u.HP_ID}</span>
              <span class="u-project-name">${u.Project_Name}</span>
            </div>
            <button onclick="location.href='edit.html?id=${u.HP_ID}'" class="btn-edit-mini"><i class="fas fa-edit text-[10px]"></i></button>
          </div>
          <div class="row-2">
            <div class="u-sale-status">${u.Status || 'AVAILABLE'}</div>
            <select onchange="quickUpdateStatus('${u.HP_ID}', this)" class="status-select st-online">
              <option value="Online" selected>‚óè ONLINE</option>
              <option value="Offline">‚óã OFFLINE</option>
              <option value="Pending">üïí PENDING</option>
            </select>
          </div>
        </div>`).join('');
    }
    async function quickUpdateStatus(id, selectEl) {
      if(selectEl.value !== 'Online' && !confirm("Item will be hidden from this list immediately. Continue?")) { selectEl.value = 'Online'; return; }
      document.getElementById('quickLoad').style.display = 'flex';
      try {
        const res = await fetch(API, { method: 'POST', body: JSON.stringify({ mode: "updateUnit", HP_ID: id, System_Status: selectEl.value }) });
        if((await res.json()).ok) { 
          // üéØ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Online ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
          init(); 
        }
      } catch(e) { alert("Sync Error!"); }
      finally { document.getElementById('quickLoad').style.display = 'none'; }
    }
    function filter() { render(); }
    window.onload = init;
  </script>
</body>
</html>
